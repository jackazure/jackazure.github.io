<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>徐明勇的技术专栏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="1.爬虫的合法性探讨robots协议隐匿身份：高匿商业代理–TOR(洋葱路由)2.爬虫的分类：通用爬虫–定向爬虫3.爬虫程序的一般步骤1234URL -- Universal Resource LocatorURI -- Universal Resource IdentifierURI &#x3D; URL + URN协议：&#x2F;&#x2F;用户名：口令@域名或IP地址：端口&#x2F;路径1&#x2F;路径2&#x2F;资源名称 123456789">
<meta property="og:type" content="article">
<meta property="og:title" content="徐明勇的技术专栏">
<meta property="og:url" content="http://lxmy.top/2021/09/11/day29%E7%88%AC%E8%99%AB%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="徐明勇的技术专栏">
<meta property="og:description" content="1.爬虫的合法性探讨robots协议隐匿身份：高匿商业代理–TOR(洋葱路由)2.爬虫的分类：通用爬虫–定向爬虫3.爬虫程序的一般步骤1234URL -- Universal Resource LocatorURI -- Universal Resource IdentifierURI &#x3D; URL + URN协议：&#x2F;&#x2F;用户名：口令@域名或IP地址：端口&#x2F;路径1&#x2F;路径2&#x2F;资源名称 123456789">
<meta property="og:locale">
<meta property="og:image" content="e:/QianFeng/教学资料/文件资料pdf/2阶段/网络请求.png">
<meta property="og:image" content="e:/QianFeng/教学资料/文件资料pdf/2阶段/请求网络的状态.jpg">
<meta property="article:published_time" content="2021-09-11T06:00:17.348Z">
<meta property="article:modified_time" content="2021-08-24T11:44:51.511Z">
<meta property="article:author" content="徐明勇">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="e:/QianFeng/教学资料/文件资料pdf/2阶段/网络请求.png">
  
    <link rel="alternate" href="/atom.xml" title="徐明勇的技术专栏" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">徐明勇的技术专栏</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">GoodGoodStudy</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://lxmy.top"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-day29爬虫总结" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/11/day29%E7%88%AC%E8%99%AB%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2021-09-11T06:00:17.348Z" itemprop="datePublished">2021-09-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1-爬虫的合法性探讨"><a href="#1-爬虫的合法性探讨" class="headerlink" title="1.爬虫的合法性探讨"></a>1.爬虫的合法性探讨</h1><h1 id="robots协议"><a href="#robots协议" class="headerlink" title="robots协议"></a>robots协议</h1><h1 id="隐匿身份：高匿商业代理–TOR-洋葱路由"><a href="#隐匿身份：高匿商业代理–TOR-洋葱路由" class="headerlink" title="隐匿身份：高匿商业代理–TOR(洋葱路由)"></a>隐匿身份：高匿商业代理–TOR(洋葱路由)</h1><h1 id="2-爬虫的分类：通用爬虫–定向爬虫"><a href="#2-爬虫的分类：通用爬虫–定向爬虫" class="headerlink" title="2.爬虫的分类：通用爬虫–定向爬虫"></a>2.爬虫的分类：通用爬虫–定向爬虫</h1><h1 id="3-爬虫程序的一般步骤"><a href="#3-爬虫程序的一般步骤" class="headerlink" title="3.爬虫程序的一般步骤"></a>3.爬虫程序的一般步骤</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">URL -- Universal Resource Locator</span><br><span class="line">URI -- Universal Resource Identifier</span><br><span class="line">URI = URL + URN</span><br><span class="line">协议：//用户名：口令@域名或IP地址：端口/路径<span class="number">1</span>/路径<span class="number">2</span>/资源名称</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">HTTP / HTTPS -- 超文本传输协议</span><br><span class="line">HTTP请求 --&gt; 服务器</span><br><span class="line">    请求行 - 命令(GET/POST) 资源路径 协议版本</span><br><span class="line">    请求头 - 键值对</span><br><span class="line">    空行</span><br><span class="line">    消息体 - 发给服务的数据</span><br><span class="line"></span><br><span class="line">HTTP响应 &lt;-- 服务器</span><br><span class="line">    响应行 - 协议版本 响应状态码</span><br><span class="line">    响应头 - 键值对</span><br><span class="line">          - content-<span class="built_in">type</span>:MIME</span><br><span class="line">            - textml</span><br><span class="line">            - application/json</span><br><span class="line">            - text/xml</span><br><span class="line">            - applicationf</span><br><span class="line">            - image/jpeg</span><br><span class="line">            - image/png</span><br><span class="line">    空行</span><br><span class="line">    消息体 - 服务器返回的数据</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="1-抓取页面"><a href="#1-抓取页面" class="headerlink" title="1)抓取页面"></a>1)抓取页面</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">urllib - python原生库(难用)</span><br><span class="line"></span><br><span class="line">requests - 第三方库</span><br><span class="line">    - get() / post() --&gt;Response --&gt;text/content/json()</span><br><span class="line">    - Session --&gt;get() / post()  (高级用法)</span><br><span class="line">    </span><br><span class="line">aiohttp / httpx</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"><span class="comment"># session.verify = False</span></span><br><span class="line">session.headers.update(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;Chrome/92.0.4515.159 Safari/537.36 &#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">res = session.get(<span class="string">&#x27;https://movie.douban.com/top250&#x27;</span>)</span><br><span class="line"><span class="comment"># print(res.status_code)  # 状态码</span></span><br><span class="line"><span class="comment"># print(res.content)  #  内容</span></span><br></pre></td></tr></table></figure>



<h1 id="2-解析页面"><a href="#2-解析页面" class="headerlink" title="2)解析页面"></a>2)解析页面</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">正则表达式 --&gt; re</span><br><span class="line">CSS选择器解析 --&gt; beautifulsoup4 / pyquery</span><br><span class="line">XPath解析 --&gt; 标签语言的查询语法 --&gt; lxml</span><br></pre></td></tr></table></figure>
<h1 id="3-数据持久化"><a href="#3-数据持久化" class="headerlink" title="3)数据持久化"></a>3)数据持久化</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CSV --&gt; csv --&gt; writer() --&gt; csvwriter --&gt; writerow/writerows</span><br><span class="line">Excel --&gt; openpyxl --&gt; Workbook() --&gt; Worksheet --&gt; add_sheet --&gt; cell --&gt; save()</span><br><span class="line">数据库</span><br><span class="line">    -关系型数据库 --&gt; MySQL / Oracle / SQLServer / DB2 / PostgreSQL</span><br><span class="line">    -NoSQL / NewSQL数据库</span><br><span class="line">分布式文件系统 --&gt; Hadoop --&gt; HDFS + MapReduce / Spark --&gt; Java / Scala / Python --&gt; Hive --&gt; SQL</span><br><span class="line">    - GFS --&gt; Google File System</span><br><span class="line">    - TFS --&gt; Taobap File System</span><br><span class="line">    - TFS --&gt; Tencent File System</span><br></pre></td></tr></table></figure>

<h2 id="实例1"><a href="#实例1" class="headerlink" title="实例1"></a>实例1</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> openpyxl</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> openpyxl.cell <span class="keyword">import</span> Cell</span><br><span class="line"><span class="keyword">from</span> openpyxl.styles <span class="keyword">import</span> Font, Alignment</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"><span class="comment"># session.verify = False</span></span><br><span class="line">session.headers.update(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;Chrome/92.0.4515.159 Safari/537.36 &#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">res = session.get(<span class="string">&#x27;https://www.sohu.com&#x27;</span>)</span><br><span class="line"><span class="comment"># pattern = re.compile(r&#x27;&lt;a\s.*?href=&quot;(.*?)&quot;.*?title=&quot;(.*?)&quot;.*?&gt;&#x27;)</span></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;a\s.*?href=&quot;(?P&lt;foo&gt;.*?)&quot;.*?title=&quot;(?P&lt;bar&gt;.*?)&quot;.*?&gt;&#x27;</span>)</span><br><span class="line"><span class="comment"># 其中?P&lt;名字&gt; 给分组命名</span></span><br><span class="line"><span class="comment"># finditer方法会返回一个迭代器对象</span></span><br><span class="line">iter_obj = pattern.finditer(res.text)</span><br><span class="line"><span class="comment"># 创建一个工作簿</span></span><br><span class="line">wb = openpyxl.Workbook()</span><br><span class="line"><span class="comment"># 获取第一个工作表</span></span><br><span class="line">sheet = wb.active</span><br><span class="line">sheet.title = <span class="string">&#x27;搜狐新闻&#x27;</span></span><br><span class="line"><span class="comment"># 修改表头单元格的宽度和高度</span></span><br><span class="line">sheet.row_dimensions[<span class="number">1</span>].height = <span class="number">35</span></span><br><span class="line">sheet.column_dimensions[<span class="string">&#x27;A&#x27;</span>].width = <span class="number">80</span></span><br><span class="line">sheet.column_dimensions[<span class="string">&#x27;B&#x27;</span>].width = <span class="number">120</span></span><br><span class="line"><span class="comment"># 向单元格写入数据</span></span><br><span class="line">sheet.cell(<span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;标题&#x27;</span>)</span><br><span class="line">sheet.cell(<span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;链接&#x27;</span>)</span><br><span class="line"><span class="comment"># 修改指定单元格的样式</span></span><br><span class="line">font = Font(size=<span class="number">18</span>, name=<span class="string">&#x27;华文楷体&#x27;</span>, bold=<span class="literal">True</span>, color=<span class="string">&#x27;ff0000&#x27;</span>)</span><br><span class="line">alignment = Alignment(horizontal=<span class="string">&#x27;center&#x27;</span>, vertical=<span class="string">&#x27;center&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> col_index <span class="keyword">in</span> <span class="string">&#x27;AB&#x27;</span>:</span><br><span class="line">    curr_cell = sheet[<span class="string">f&#x27;<span class="subst">&#123;col_index&#125;</span>1&#x27;</span>]  <span class="comment"># type: Cell</span></span><br><span class="line">    curr_cell.font = font</span><br><span class="line">    curr_cell.alignment = alignment</span><br><span class="line"><span class="comment"># 通过对迭代器对象的循环遍历可以获得Match对象</span></span><br><span class="line"><span class="keyword">for</span> index, matcher <span class="keyword">in</span> <span class="built_in">enumerate</span>(iter_obj):</span><br><span class="line">    <span class="comment"># # 获取整个a标签</span></span><br><span class="line">    <span class="comment"># print(matcher.group())</span></span><br><span class="line">    <span class="comment"># # 获取捕获组的内容</span></span><br><span class="line">    <span class="comment"># print(matcher.group(&#x27;bar&#x27;))</span></span><br><span class="line">    <span class="comment"># print(matcher.group(&#x27;foo&#x27;))</span></span><br><span class="line">    sheet.cell(index + <span class="number">2</span>, <span class="number">1</span>, matcher.group(<span class="string">&#x27;bar&#x27;</span>))</span><br><span class="line">    sheet.cell(index + <span class="number">2</span>, <span class="number">2</span>, matcher.group(<span class="string">&#x27;foo&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存工作簿</span></span><br><span class="line">wb.save(<span class="string">&#x27;files/爬虫数据文件.xlsx&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过对迭代器对象的循环遍历可以获得Match对象</span></span><br><span class="line"><span class="comment"># for matcher in iter_obj:</span></span><br><span class="line"><span class="comment">#     # 获取整个a标签</span></span><br><span class="line"><span class="comment">#     print(matcher.group())</span></span><br><span class="line"><span class="comment">#     # 获取捕获组的内容</span></span><br><span class="line"><span class="comment">#     print(matcher.group(1))</span></span><br><span class="line"><span class="comment">#     print(matcher.group(2))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># #根据正则表达式匹配a标签的href和title属性得到一个列表</span></span><br><span class="line"><span class="comment"># anchors_list = pattern.findall(res.text)</span></span><br><span class="line"><span class="comment"># for href, title in anchors_list:</span></span><br><span class="line"><span class="comment">#     print(href)</span></span><br><span class="line"><span class="comment">#     print(title)</span></span><br></pre></td></tr></table></figure>





<h1 id="4-HTML页面的结构"><a href="#4-HTML页面的结构" class="headerlink" title="4.HTML页面的结构"></a>4.HTML页面的结构</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">超文本标签语言 -- 所有的内容都放在标签下</span><br><span class="line"></span><br><span class="line">    - 标签：承载内容</span><br><span class="line">    - CSS(Cascading Style Sheet):页面渲染</span><br><span class="line">        选择器 --&gt; 样式属性名：样式属性值</span><br><span class="line">        - 标签选择器</span><br><span class="line">        - 类选择器</span><br><span class="line">        - ID选择器</span><br><span class="line">        - 父子选择器：div&gt;p</span><br><span class="line">        - 后代选择器：div p</span><br><span class="line">        - 兄弟选择器：div - p</span><br><span class="line">        - 相邻兄弟选择器：div + p</span><br><span class="line">        - 伪类/伪元素：a:visited / p:first-letter</span><br><span class="line">    - JavaScript(JS):交互式行为</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="5-解析页面的三种方式"><a href="#5-解析页面的三种方式" class="headerlink" title="5.解析页面的三种方式"></a>5.解析页面的三种方式</h1><h1 id="正则表达式解析-–-gt-re"><a href="#正则表达式解析-–-gt-re" class="headerlink" title="正则表达式解析 –&gt; re"></a>正则表达式解析 –&gt; re</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">    - 直接调用re模块的函数</span><br><span class="line">        - search --&gt; Match</span><br><span class="line">        - findall --&gt; <span class="built_in">list</span>[<span class="built_in">str</span>]</span><br><span class="line">        - finditer --&gt; iterator --&gt; Match --&gt; group()</span><br><span class="line">    - 创建Pattern对象，给对象发消息</span><br><span class="line">        - <span class="built_in">compile</span> --&gt; Pattern</span><br><span class="line">        - search --&gt; Match --&gt; group()</span><br><span class="line">        - findall / finditer</span><br><span class="line"></span><br><span class="line"><span class="comment"># CSS选择器解析</span></span><br><span class="line"></span><br><span class="line">    - BeautifulSoup --&gt; beautifulsoup4 --&gt; bs4</span><br><span class="line">    - PyQuery --&gt; pip install pyquery --&gt; 有jQuery使用经验</span><br><span class="line"></span><br><span class="line"><span class="comment"># XPath解析</span></span><br><span class="line"><span class="comment">#     -lxml --&gt; pip install lxml</span></span><br></pre></td></tr></table></figure>

<h1 id="6-数据持久化"><a href="#6-数据持久化" class="headerlink" title="6.数据持久化"></a>6.数据持久化</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CSV文件</span></span><br><span class="line"><span class="comment"># Excel文件</span></span><br><span class="line"><span class="comment"># 数据库</span></span><br><span class="line"><span class="comment"># 大数据平台</span></span><br></pre></td></tr></table></figure>



<h2 id="实例2"><a href="#实例2" class="headerlink" title="实例2"></a>实例2</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome, ChromeOptions</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.创建谷歌浏览器的配置对象</span></span><br><span class="line">options = ChromeOptions()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1)添加取消测试环境选项</span></span><br><span class="line">options.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2)取消图片加载</span></span><br><span class="line"><span class="comment"># options.add_experimental_option(&quot;prefs&quot;, &#123;&quot;profile.managed_default_content_settings.images&quot;: 2&#125;)</span></span><br><span class="line"></span><br><span class="line">browser = Chrome(options=options)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 破解selenium反爬的重要代码</span></span><br><span class="line"><span class="comment"># 防止selenium被监测</span></span><br><span class="line"><span class="comment"># 先修改js，再加载js</span></span><br><span class="line">browser.execute_cdp_cmd(</span><br><span class="line">    <span class="string">&quot;Page.addScriptToEvaluateOnNewDocument&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;source&quot;</span>: <span class="string">&quot;Object.defineProperty(navigator, &#x27;webdriver&#x27;, &#123;get: () =&gt; undefined&#125;)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">browser.get(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line">browser.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">anchor = browser.find_element_by_css_selector(<span class="string">&#x27;#s-top-left &gt; a:nth-child(7)&#x27;</span>)</span><br><span class="line"><span class="comment"># 通过WebElement对象的is_displayed方法判定元素是否可见</span></span><br><span class="line"><span class="comment"># 注意：不可见的超链接一般都不能访问，因为它极有可能是一个诱使爬虫访问的蜜罐链接</span></span><br><span class="line"><span class="built_in">print</span>(anchor.is_displayed())</span><br><span class="line"><span class="comment"># 该标签的尺寸</span></span><br><span class="line"><span class="built_in">print</span>(anchor.size)</span><br><span class="line"><span class="comment"># 该标签在当前页面的位置</span></span><br><span class="line"><span class="built_in">print</span>(anchor.location)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 浏览器窗口截图</span></span><br><span class="line">browser.get_screenshot_as_file(<span class="string">&#x27;files/baidu.png&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="光学文字识别"><a href="#光学文字识别" class="headerlink" title="光学文字识别"></a>光学文字识别</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> easyocr</span><br><span class="line"></span><br><span class="line">reader = easyocr.Reader([<span class="string">&#x27;ch_sim&#x27;</span>, <span class="string">&#x27;en&#x27;</span>], gpu=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(reader.readtext(<span class="string">&#x27;files/idcard.jpg&#x27;</span>, detail=<span class="number">0</span>))</span><br></pre></td></tr></table></figure>



<h2 id="从页面上抠图"><a href="#从页面上抠图" class="headerlink" title="从页面上抠图"></a>从页面上抠图</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image <span class="keyword">as</span> img</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> ImageFilter</span><br><span class="line"><span class="keyword">from</span> PIL.Image <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">image = img.<span class="built_in">open</span>(<span class="string">&#x27;files/idcard.jpg&#x27;</span>)  <span class="comment"># type: Image</span></span><br><span class="line"><span class="built_in">print</span>(image.size)</span><br><span class="line"><span class="comment"># 使用滤镜处理图片</span></span><br><span class="line">emboss_image = image.<span class="built_in">filter</span>(ImageFilter.EMBOSS)</span><br><span class="line">emboss_image.show()</span><br><span class="line"><span class="comment"># 抠图</span></span><br><span class="line">head = image.crop((<span class="number">320</span>, <span class="number">50</span>, <span class="number">460</span>, <span class="number">235</span>))</span><br><span class="line"><span class="comment"># # 显示图片</span></span><br><span class="line">head.show()</span><br><span class="line"><span class="comment"># 保存图片</span></span><br><span class="line"><span class="comment"># head.save(&#x27;files/head.jpg&#x27;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h1 id="7-常见的反爬方式及破解"><a href="#7-常见的反爬方式及破解" class="headerlink" title="7.常见的反爬方式及破解"></a>7.常见的反爬方式及破解</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">请求头检查</span><br><span class="line">    - User-Agent</span><br><span class="line">    - Referer --&gt; 网站防盗链接</span><br><span class="line">    - Accept</span><br><span class="line">    - Accept-Language</span><br><span class="line">    - Accept-Encoding</span><br><span class="line">限速和封禁IP</span><br><span class="line">    - 商业IP代理 --&gt; 蘑菇代理 / 芝麻代理 / 快代理 / 阿布云代理</span><br><span class="line">    - 代理池(提前放置好一堆代理，有对应的维护机制，能够动态替换掉失效代理)</span><br><span class="line">身份验证</span><br><span class="line">    - 服务器如何识别你是否登录？</span><br><span class="line">        - 从请求中获取用户的身份标识</span><br><span class="line">        - 对于登录成功的用户，服务器通常会将用户身份标识写入浏览器本地存储</span><br><span class="line">            - Cookie</span><br><span class="line">            - localStorage / sessionStorage</span><br><span class="line">            - IndexedDB</span><br><span class="line">            --&gt; 下次请求要带上自己的身份标识(修改请求头、修改Cookie信息)</span><br><span class="line">    - Cookie池(提前准备好多个登录用户的身份信息，轮换着使用)</span><br><span class="line"></span><br><span class="line">动态内容</span><br><span class="line">    - 抓取接口</span><br><span class="line">        - 浏览器开发者工具 --&gt; Network --&gt; Fetch/XHR(异步请求)</span><br><span class="line">        - 专业(HTTP)抓包工具</span><br><span class="line">            - Charles / Fiddler --&gt; 将它设置为浏览器的代理</span><br><span class="line">            - WireShark --&gt; Ethereal --&gt; 协议分析工具</span><br><span class="line">    - Selenium WebDriver --&gt; 用代码驱动浏览器    </span><br><span class="line">    - Puppeteer --&gt; Pyppeteer --&gt; Chromium</span><br><span class="line"></span><br><span class="line">爬虫蜜罐</span><br><span class="line">    - Selenium --&gt; WebElement --&gt; is_displayed()</span><br><span class="line"></span><br><span class="line">验证码</span><br><span class="line">    CAPTCHA --&gt; 图灵测试</span><br><span class="line">    OCR --&gt; Optical Character Recognition</span><br><span class="line">    teseract --&gt; pytesseract</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    - easyocr</span><br><span class="line">    - 打码平台</span><br><span class="line"></span><br><span class="line">字体反爬</span><br><span class="line">JS加密和混淆</span><br></pre></td></tr></table></figure>
<h1 id="8-加速爬取的方式"><a href="#8-加速爬取的方式" class="headerlink" title="8.加速爬取的方式"></a>8.加速爬取的方式</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">并发编程</span><br><span class="line">    - 多线程</span><br><span class="line">        - Thread(target=..., args=(...,...)) --&gt; start()</span><br><span class="line">        - 继承Thread，重写run()方法 --&gt; 创建自定义类的对象 --&gt; start()</span><br><span class="line">        - ThreadPoolExecutor() --&gt; submit(fn,...) / <span class="built_in">map</span>(fn,[...])</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    - 多进程   </span><br><span class="line">        - Prcoess(target=..., args=(...,...)) --&gt; start()</span><br><span class="line">        - 继承Thread，重写run()方法 --&gt; 创建自定义类的对象 --&gt; start()</span><br><span class="line">        - ThreadPoolExecutor() --&gt; submit(fn,...) / <span class="built_in">map</span>(fn,[...])</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    - 异步编程(异步IO)</span><br><span class="line">    </span><br><span class="line">    - I/O密集型任务 --&gt; 大量的操作都是输入输出的操作，需要CPU运算很少</span><br><span class="line">    - 计算密集型任务  --&gt; 大量的操作都是需要CPU做运算，I/O中断很少发生</span><br><span class="line">    </span><br><span class="line">    官方的CPython因为是用C语言实现的Python解释器，因为C语言底层申请和释放内存的操作</span><br><span class="line">    并不是线程安全的，所有在Python解释器中引入了GIL(全局解释器锁)。因为GIL的存在，</span><br><span class="line">    CPython中的多线程并不能够发挥CPU多核的优势。在处理计算密集型任务时，应该考虑使用</span><br><span class="line">    多进程，因为每个进程都有自己的GIL，每个进程可以在不同的核上运转起来，这样才能发挥</span><br><span class="line">    CPU多核特性的优势。</span><br><span class="line">    </span><br><span class="line">分布式爬虫</span><br><span class="line">    一台机器必然有能力的极限，为了突破这个极限，我们可以选择将单机结构变成一个多机结构，这个多机结构就是一个分布式系统</span><br><span class="line">    如何协调多个机器的行为，让他们可以互相协作，共同完成一个目标？</span><br><span class="line">    数据中转站</span><br><span class="line">    </span><br><span class="line">    要点：一般会通过部署Redis数据库(KV数据库)，通过这个数据库保存待爬取的页面、</span><br><span class="line">    爬取过的页面、有可能还要保存一些数据，这样多个运行爬虫程序的计算机，就可能彼此</span><br><span class="line">    协调行为，最终达成一个共同的目标。</span><br></pre></td></tr></table></figure>
<h1 id="9-爬虫框架的应用"><a href="#9-爬虫框架的应用" class="headerlink" title="9.爬虫框架的应用"></a>9.爬虫框架的应用</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">框架 --&gt; 把项目开发中常用功能和样板代码全部都封装好了，你可以专注于核心问题，</span><br><span class="line">而不要再次编写重复的样板代码，重复的去实现之前已经实现过无数次的功能。</span><br><span class="line"></span><br><span class="line">PySpider</span><br><span class="line"></span><br><span class="line">Scrapy --&gt; 命令行工具 --&gt; 创建爬虫项目</span><br><span class="line">    - 安装：pip install scrapy</span><br><span class="line">    - 创建Scrapy项目：scrapy startproject demo</span><br><span class="line">    - 创建一个蜘蛛：scrapy genspider douban movie.douban.com</span><br><span class="line">    - 修改配置文件：</span><br><span class="line">        - USER-AGENT</span><br><span class="line">        - DOWNLOAD_DELAY</span><br><span class="line">        -CONCURRENT_REQUESTS</span><br><span class="line">    - 运行一个蜘蛛：scrapy crawl douban</span><br><span class="line">        - scrapy crawl douban -o douban.csv</span><br><span class="line">        - scrapy crawl douban -o douban.json</span><br></pre></td></tr></table></figure>

<p><img src="E:\QianFeng\教学资料\文件资料pdf\2阶段\网络请求.png"></p>
<p><img src="E:\QianFeng\教学资料\文件资料pdf\2阶段\请求网络的状态.jpg"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://lxmy.top/2021/09/11/day29%E7%88%AC%E8%99%AB%E6%80%BB%E7%BB%93/" data-id="cktfic7u60002mwuchtip7qs0" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/09/11/day30%E7%88%AC%E8%99%AB%E6%80%BB%E7%BB%93/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2021/09/11/day28%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/09/11/day30%E7%88%AC%E8%99%AB%E6%80%BB%E7%BB%93/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/09/11/day29%E7%88%AC%E8%99%AB%E6%80%BB%E7%BB%93/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/09/11/day28%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 徐明勇<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>