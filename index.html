<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>徐明勇的技术专栏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="徐明勇的技术专栏">
<meta property="og:url" content="http://lxmy.top/index.html">
<meta property="og:site_name" content="徐明勇的技术专栏">
<meta property="og:locale">
<meta property="article:author" content="徐明勇">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="徐明勇的技术专栏" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">徐明勇的技术专栏</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">GoodGoodStudy</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://lxmy.top"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-stage2/2-2 (9)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/13/stage2/2-2%20(9)/" class="article-date">
  <time class="dt-published" datetime="2021-09-13T00:36:53.733Z" itemprop="datePublished">2021-09-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1-爬虫的合法性探讨"><a href="#1-爬虫的合法性探讨" class="headerlink" title="1.爬虫的合法性探讨"></a>1.爬虫的合法性探讨</h1><h1 id="robots协议"><a href="#robots协议" class="headerlink" title="robots协议"></a>robots协议</h1><h1 id="隐匿身份：高匿商业代理–TOR-洋葱路由"><a href="#隐匿身份：高匿商业代理–TOR-洋葱路由" class="headerlink" title="隐匿身份：高匿商业代理–TOR(洋葱路由)"></a>隐匿身份：高匿商业代理–TOR(洋葱路由)</h1><h1 id="2-爬虫的分类：通用爬虫–定向爬虫"><a href="#2-爬虫的分类：通用爬虫–定向爬虫" class="headerlink" title="2.爬虫的分类：通用爬虫–定向爬虫"></a>2.爬虫的分类：通用爬虫–定向爬虫</h1><h1 id="3-爬虫程序的一般步骤"><a href="#3-爬虫程序的一般步骤" class="headerlink" title="3.爬虫程序的一般步骤"></a>3.爬虫程序的一般步骤</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">URL -- Universal Resource Locator</span><br><span class="line">URI -- Universal Resource Identifier</span><br><span class="line">URI = URL + URN</span><br><span class="line">协议：//用户名：口令@域名或IP地址：端口/路径<span class="number">1</span>/路径<span class="number">2</span>/资源名称</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">HTTP / HTTPS -- 超文本传输协议</span><br><span class="line">HTTP请求 --&gt; 服务器</span><br><span class="line">    请求行 - 命令(GET/POST) 资源路径 协议版本</span><br><span class="line">    请求头 - 键值对</span><br><span class="line">    空行</span><br><span class="line">    消息体 - 发给服务的数据</span><br><span class="line"></span><br><span class="line">HTTP响应 &lt;-- 服务器</span><br><span class="line">    响应行 - 协议版本 响应状态码</span><br><span class="line">    响应头 - 键值对</span><br><span class="line">          - content-<span class="built_in">type</span>:MIME</span><br><span class="line">            - textml</span><br><span class="line">            - application/json</span><br><span class="line">            - text/xml</span><br><span class="line">            - applicationf</span><br><span class="line">            - image/jpeg</span><br><span class="line">            - image/png</span><br><span class="line">    空行</span><br><span class="line">    消息体 - 服务器返回的数据</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="1-抓取页面"><a href="#1-抓取页面" class="headerlink" title="1)抓取页面"></a>1)抓取页面</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">urllib - python原生库(难用)</span><br><span class="line"></span><br><span class="line">requests - 第三方库</span><br><span class="line">    - get() / post() --&gt;Response --&gt;text/content/json()</span><br><span class="line">    - Session --&gt;get() / post()  (高级用法)</span><br><span class="line">    </span><br><span class="line">aiohttp / httpx</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"><span class="comment"># session.verify = False</span></span><br><span class="line">session.headers.update(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;Chrome/92.0.4515.159 Safari/537.36 &#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">res = session.get(<span class="string">&#x27;https://movie.douban.com/top250&#x27;</span>)</span><br><span class="line"><span class="comment"># print(res.status_code)  # 状态码</span></span><br><span class="line"><span class="comment"># print(res.content)  #  内容</span></span><br></pre></td></tr></table></figure>



<h1 id="2-解析页面"><a href="#2-解析页面" class="headerlink" title="2)解析页面"></a>2)解析页面</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">正则表达式 --&gt; re</span><br><span class="line">CSS选择器解析 --&gt; beautifulsoup4 / pyquery</span><br><span class="line">XPath解析 --&gt; 标签语言的查询语法 --&gt; lxml</span><br></pre></td></tr></table></figure>
<h1 id="3-数据持久化"><a href="#3-数据持久化" class="headerlink" title="3)数据持久化"></a>3)数据持久化</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CSV --&gt; csv --&gt; writer() --&gt; csvwriter --&gt; writerow/writerows</span><br><span class="line">Excel --&gt; openpyxl --&gt; Workbook() --&gt; Worksheet --&gt; add_sheet --&gt; cell --&gt; save()</span><br><span class="line">数据库</span><br><span class="line">    -关系型数据库 --&gt; MySQL / Oracle / SQLServer / DB2 / PostgreSQL</span><br><span class="line">    -NoSQL / NewSQL数据库</span><br><span class="line">分布式文件系统 --&gt; Hadoop --&gt; HDFS + MapReduce / Spark --&gt; Java / Scala / Python --&gt; Hive --&gt; SQL</span><br><span class="line">    - GFS --&gt; Google File System</span><br><span class="line">    - TFS --&gt; Taobap File System</span><br><span class="line">    - TFS --&gt; Tencent File System</span><br></pre></td></tr></table></figure>

<h2 id="实例1"><a href="#实例1" class="headerlink" title="实例1"></a>实例1</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> openpyxl</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> openpyxl.cell <span class="keyword">import</span> Cell</span><br><span class="line"><span class="keyword">from</span> openpyxl.styles <span class="keyword">import</span> Font, Alignment</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"><span class="comment"># session.verify = False</span></span><br><span class="line">session.headers.update(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;Chrome/92.0.4515.159 Safari/537.36 &#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">res = session.get(<span class="string">&#x27;https://www.sohu.com&#x27;</span>)</span><br><span class="line"><span class="comment"># pattern = re.compile(r&#x27;&lt;a\s.*?href=&quot;(.*?)&quot;.*?title=&quot;(.*?)&quot;.*?&gt;&#x27;)</span></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;a\s.*?href=&quot;(?P&lt;foo&gt;.*?)&quot;.*?title=&quot;(?P&lt;bar&gt;.*?)&quot;.*?&gt;&#x27;</span>)</span><br><span class="line"><span class="comment"># 其中?P&lt;名字&gt; 给分组命名</span></span><br><span class="line"><span class="comment"># finditer方法会返回一个迭代器对象</span></span><br><span class="line">iter_obj = pattern.finditer(res.text)</span><br><span class="line"><span class="comment"># 创建一个工作簿</span></span><br><span class="line">wb = openpyxl.Workbook()</span><br><span class="line"><span class="comment"># 获取第一个工作表</span></span><br><span class="line">sheet = wb.active</span><br><span class="line">sheet.title = <span class="string">&#x27;搜狐新闻&#x27;</span></span><br><span class="line"><span class="comment"># 修改表头单元格的宽度和高度</span></span><br><span class="line">sheet.row_dimensions[<span class="number">1</span>].height = <span class="number">35</span></span><br><span class="line">sheet.column_dimensions[<span class="string">&#x27;A&#x27;</span>].width = <span class="number">80</span></span><br><span class="line">sheet.column_dimensions[<span class="string">&#x27;B&#x27;</span>].width = <span class="number">120</span></span><br><span class="line"><span class="comment"># 向单元格写入数据</span></span><br><span class="line">sheet.cell(<span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;标题&#x27;</span>)</span><br><span class="line">sheet.cell(<span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;链接&#x27;</span>)</span><br><span class="line"><span class="comment"># 修改指定单元格的样式</span></span><br><span class="line">font = Font(size=<span class="number">18</span>, name=<span class="string">&#x27;华文楷体&#x27;</span>, bold=<span class="literal">True</span>, color=<span class="string">&#x27;ff0000&#x27;</span>)</span><br><span class="line">alignment = Alignment(horizontal=<span class="string">&#x27;center&#x27;</span>, vertical=<span class="string">&#x27;center&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> col_index <span class="keyword">in</span> <span class="string">&#x27;AB&#x27;</span>:</span><br><span class="line">    curr_cell = sheet[<span class="string">f&#x27;<span class="subst">&#123;col_index&#125;</span>1&#x27;</span>]  <span class="comment"># type: Cell</span></span><br><span class="line">    curr_cell.font = font</span><br><span class="line">    curr_cell.alignment = alignment</span><br><span class="line"><span class="comment"># 通过对迭代器对象的循环遍历可以获得Match对象</span></span><br><span class="line"><span class="keyword">for</span> index, matcher <span class="keyword">in</span> <span class="built_in">enumerate</span>(iter_obj):</span><br><span class="line">    <span class="comment"># # 获取整个a标签</span></span><br><span class="line">    <span class="comment"># print(matcher.group())</span></span><br><span class="line">    <span class="comment"># # 获取捕获组的内容</span></span><br><span class="line">    <span class="comment"># print(matcher.group(&#x27;bar&#x27;))</span></span><br><span class="line">    <span class="comment"># print(matcher.group(&#x27;foo&#x27;))</span></span><br><span class="line">    sheet.cell(index + <span class="number">2</span>, <span class="number">1</span>, matcher.group(<span class="string">&#x27;bar&#x27;</span>))</span><br><span class="line">    sheet.cell(index + <span class="number">2</span>, <span class="number">2</span>, matcher.group(<span class="string">&#x27;foo&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存工作簿</span></span><br><span class="line">wb.save(<span class="string">&#x27;files/爬虫数据文件.xlsx&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过对迭代器对象的循环遍历可以获得Match对象</span></span><br><span class="line"><span class="comment"># for matcher in iter_obj:</span></span><br><span class="line"><span class="comment">#     # 获取整个a标签</span></span><br><span class="line"><span class="comment">#     print(matcher.group())</span></span><br><span class="line"><span class="comment">#     # 获取捕获组的内容</span></span><br><span class="line"><span class="comment">#     print(matcher.group(1))</span></span><br><span class="line"><span class="comment">#     print(matcher.group(2))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># #根据正则表达式匹配a标签的href和title属性得到一个列表</span></span><br><span class="line"><span class="comment"># anchors_list = pattern.findall(res.text)</span></span><br><span class="line"><span class="comment"># for href, title in anchors_list:</span></span><br><span class="line"><span class="comment">#     print(href)</span></span><br><span class="line"><span class="comment">#     print(title)</span></span><br></pre></td></tr></table></figure>





<h1 id="4-HTML页面的结构"><a href="#4-HTML页面的结构" class="headerlink" title="4.HTML页面的结构"></a>4.HTML页面的结构</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">超文本标签语言 -- 所有的内容都放在标签下</span><br><span class="line"></span><br><span class="line">    - 标签：承载内容</span><br><span class="line">    - CSS(Cascading Style Sheet):页面渲染</span><br><span class="line">        选择器 --&gt; 样式属性名：样式属性值</span><br><span class="line">        - 标签选择器</span><br><span class="line">        - 类选择器</span><br><span class="line">        - ID选择器</span><br><span class="line">        - 父子选择器：div&gt;p</span><br><span class="line">        - 后代选择器：div p</span><br><span class="line">        - 兄弟选择器：div - p</span><br><span class="line">        - 相邻兄弟选择器：div + p</span><br><span class="line">        - 伪类/伪元素：a:visited / p:first-letter</span><br><span class="line">    - JavaScript(JS):交互式行为</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="5-解析页面的三种方式"><a href="#5-解析页面的三种方式" class="headerlink" title="5.解析页面的三种方式"></a>5.解析页面的三种方式</h1><h1 id="正则表达式解析-–-gt-re"><a href="#正则表达式解析-–-gt-re" class="headerlink" title="正则表达式解析 –&gt; re"></a>正则表达式解析 –&gt; re</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">    - 直接调用re模块的函数</span><br><span class="line">        - search --&gt; Match</span><br><span class="line">        - findall --&gt; <span class="built_in">list</span>[<span class="built_in">str</span>]</span><br><span class="line">        - finditer --&gt; iterator --&gt; Match --&gt; group()</span><br><span class="line">    - 创建Pattern对象，给对象发消息</span><br><span class="line">        - <span class="built_in">compile</span> --&gt; Pattern</span><br><span class="line">        - search --&gt; Match --&gt; group()</span><br><span class="line">        - findall / finditer</span><br><span class="line"></span><br><span class="line"><span class="comment"># CSS选择器解析</span></span><br><span class="line"></span><br><span class="line">    - BeautifulSoup --&gt; beautifulsoup4 --&gt; bs4</span><br><span class="line">    - PyQuery --&gt; pip install pyquery --&gt; 有jQuery使用经验</span><br><span class="line"></span><br><span class="line"><span class="comment"># XPath解析</span></span><br><span class="line"><span class="comment">#     -lxml --&gt; pip install lxml</span></span><br></pre></td></tr></table></figure>

<h1 id="6-数据持久化"><a href="#6-数据持久化" class="headerlink" title="6.数据持久化"></a>6.数据持久化</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CSV文件</span></span><br><span class="line"><span class="comment"># Excel文件</span></span><br><span class="line"><span class="comment"># 数据库</span></span><br><span class="line"><span class="comment"># 大数据平台</span></span><br></pre></td></tr></table></figure>



<h2 id="实例2"><a href="#实例2" class="headerlink" title="实例2"></a>实例2</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome, ChromeOptions</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.创建谷歌浏览器的配置对象</span></span><br><span class="line">options = ChromeOptions()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1)添加取消测试环境选项</span></span><br><span class="line">options.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2)取消图片加载</span></span><br><span class="line"><span class="comment"># options.add_experimental_option(&quot;prefs&quot;, &#123;&quot;profile.managed_default_content_settings.images&quot;: 2&#125;)</span></span><br><span class="line"></span><br><span class="line">browser = Chrome(options=options)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 破解selenium反爬的重要代码</span></span><br><span class="line"><span class="comment"># 防止selenium被监测</span></span><br><span class="line"><span class="comment"># 先修改js，再加载js</span></span><br><span class="line">browser.execute_cdp_cmd(</span><br><span class="line">    <span class="string">&quot;Page.addScriptToEvaluateOnNewDocument&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;source&quot;</span>: <span class="string">&quot;Object.defineProperty(navigator, &#x27;webdriver&#x27;, &#123;get: () =&gt; undefined&#125;)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">browser.get(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line">browser.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">anchor = browser.find_element_by_css_selector(<span class="string">&#x27;#s-top-left &gt; a:nth-child(7)&#x27;</span>)</span><br><span class="line"><span class="comment"># 通过WebElement对象的is_displayed方法判定元素是否可见</span></span><br><span class="line"><span class="comment"># 注意：不可见的超链接一般都不能访问，因为它极有可能是一个诱使爬虫访问的蜜罐链接</span></span><br><span class="line"><span class="built_in">print</span>(anchor.is_displayed())</span><br><span class="line"><span class="comment"># 该标签的尺寸</span></span><br><span class="line"><span class="built_in">print</span>(anchor.size)</span><br><span class="line"><span class="comment"># 该标签在当前页面的位置</span></span><br><span class="line"><span class="built_in">print</span>(anchor.location)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 浏览器窗口截图</span></span><br><span class="line">browser.get_screenshot_as_file(<span class="string">&#x27;files/baidu.png&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="光学文字识别"><a href="#光学文字识别" class="headerlink" title="光学文字识别"></a>光学文字识别</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> easyocr</span><br><span class="line"></span><br><span class="line">reader = easyocr.Reader([<span class="string">&#x27;ch_sim&#x27;</span>, <span class="string">&#x27;en&#x27;</span>], gpu=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(reader.readtext(<span class="string">&#x27;files/idcard.jpg&#x27;</span>, detail=<span class="number">0</span>))</span><br></pre></td></tr></table></figure>



<h2 id="从页面上抠图"><a href="#从页面上抠图" class="headerlink" title="从页面上抠图"></a>从页面上抠图</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image <span class="keyword">as</span> img</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> ImageFilter</span><br><span class="line"><span class="keyword">from</span> PIL.Image <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">image = img.<span class="built_in">open</span>(<span class="string">&#x27;files/idcard.jpg&#x27;</span>)  <span class="comment"># type: Image</span></span><br><span class="line"><span class="built_in">print</span>(image.size)</span><br><span class="line"><span class="comment"># 使用滤镜处理图片</span></span><br><span class="line">emboss_image = image.<span class="built_in">filter</span>(ImageFilter.EMBOSS)</span><br><span class="line">emboss_image.show()</span><br><span class="line"><span class="comment"># 抠图</span></span><br><span class="line">head = image.crop((<span class="number">320</span>, <span class="number">50</span>, <span class="number">460</span>, <span class="number">235</span>))</span><br><span class="line"><span class="comment"># # 显示图片</span></span><br><span class="line">head.show()</span><br><span class="line"><span class="comment"># 保存图片</span></span><br><span class="line"><span class="comment"># head.save(&#x27;files/head.jpg&#x27;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h1 id="7-常见的反爬方式及破解"><a href="#7-常见的反爬方式及破解" class="headerlink" title="7.常见的反爬方式及破解"></a>7.常见的反爬方式及破解</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">请求头检查</span><br><span class="line">    - User-Agent</span><br><span class="line">    - Referer --&gt; 网站防盗链接</span><br><span class="line">    - Accept</span><br><span class="line">    - Accept-Language</span><br><span class="line">    - Accept-Encoding</span><br><span class="line">限速和封禁IP</span><br><span class="line">    - 商业IP代理 --&gt; 蘑菇代理 / 芝麻代理 / 快代理 / 阿布云代理</span><br><span class="line">    - 代理池(提前放置好一堆代理，有对应的维护机制，能够动态替换掉失效代理)</span><br><span class="line">身份验证</span><br><span class="line">    - 服务器如何识别你是否登录？</span><br><span class="line">        - 从请求中获取用户的身份标识</span><br><span class="line">        - 对于登录成功的用户，服务器通常会将用户身份标识写入浏览器本地存储</span><br><span class="line">            - Cookie</span><br><span class="line">            - localStorage / sessionStorage</span><br><span class="line">            - IndexedDB</span><br><span class="line">            --&gt; 下次请求要带上自己的身份标识(修改请求头、修改Cookie信息)</span><br><span class="line">    - Cookie池(提前准备好多个登录用户的身份信息，轮换着使用)</span><br><span class="line"></span><br><span class="line">动态内容</span><br><span class="line">    - 抓取接口</span><br><span class="line">        - 浏览器开发者工具 --&gt; Network --&gt; Fetch/XHR(异步请求)</span><br><span class="line">        - 专业(HTTP)抓包工具</span><br><span class="line">            - Charles / Fiddler --&gt; 将它设置为浏览器的代理</span><br><span class="line">            - WireShark --&gt; Ethereal --&gt; 协议分析工具</span><br><span class="line">    - Selenium WebDriver --&gt; 用代码驱动浏览器    </span><br><span class="line">    - Puppeteer --&gt; Pyppeteer --&gt; Chromium</span><br><span class="line"></span><br><span class="line">爬虫蜜罐</span><br><span class="line">    - Selenium --&gt; WebElement --&gt; is_displayed()</span><br><span class="line"></span><br><span class="line">验证码</span><br><span class="line">    CAPTCHA --&gt; 图灵测试</span><br><span class="line">    OCR --&gt; Optical Character Recognition</span><br><span class="line">    teseract --&gt; pytesseract</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    - easyocr</span><br><span class="line">    - 打码平台</span><br><span class="line"></span><br><span class="line">字体反爬</span><br><span class="line">JS加密和混淆</span><br></pre></td></tr></table></figure>
<h1 id="8-加速爬取的方式"><a href="#8-加速爬取的方式" class="headerlink" title="8.加速爬取的方式"></a>8.加速爬取的方式</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">并发编程</span><br><span class="line">    - 多线程</span><br><span class="line">        - Thread(target=..., args=(...,...)) --&gt; start()</span><br><span class="line">        - 继承Thread，重写run()方法 --&gt; 创建自定义类的对象 --&gt; start()</span><br><span class="line">        - ThreadPoolExecutor() --&gt; submit(fn,...) / <span class="built_in">map</span>(fn,[...])</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    - 多进程   </span><br><span class="line">        - Prcoess(target=..., args=(...,...)) --&gt; start()</span><br><span class="line">        - 继承Thread，重写run()方法 --&gt; 创建自定义类的对象 --&gt; start()</span><br><span class="line">        - ThreadPoolExecutor() --&gt; submit(fn,...) / <span class="built_in">map</span>(fn,[...])</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    - 异步编程(异步IO)</span><br><span class="line">    </span><br><span class="line">    - I/O密集型任务 --&gt; 大量的操作都是输入输出的操作，需要CPU运算很少</span><br><span class="line">    - 计算密集型任务  --&gt; 大量的操作都是需要CPU做运算，I/O中断很少发生</span><br><span class="line">    </span><br><span class="line">    官方的CPython因为是用C语言实现的Python解释器，因为C语言底层申请和释放内存的操作</span><br><span class="line">    并不是线程安全的，所有在Python解释器中引入了GIL(全局解释器锁)。因为GIL的存在，</span><br><span class="line">    CPython中的多线程并不能够发挥CPU多核的优势。在处理计算密集型任务时，应该考虑使用</span><br><span class="line">    多进程，因为每个进程都有自己的GIL，每个进程可以在不同的核上运转起来，这样才能发挥</span><br><span class="line">    CPU多核特性的优势。</span><br><span class="line">    </span><br><span class="line">分布式爬虫</span><br><span class="line">    一台机器必然有能力的极限，为了突破这个极限，我们可以选择将单机结构变成一个多机结构，这个多机结构就是一个分布式系统</span><br><span class="line">    如何协调多个机器的行为，让他们可以互相协作，共同完成一个目标？</span><br><span class="line">    数据中转站</span><br><span class="line">    </span><br><span class="line">    要点：一般会通过部署Redis数据库(KV数据库)，通过这个数据库保存待爬取的页面、</span><br><span class="line">    爬取过的页面、有可能还要保存一些数据，这样多个运行爬虫程序的计算机，就可能彼此</span><br><span class="line">    协调行为，最终达成一个共同的目标。</span><br></pre></td></tr></table></figure>
<h1 id="9-爬虫框架的应用"><a href="#9-爬虫框架的应用" class="headerlink" title="9.爬虫框架的应用"></a>9.爬虫框架的应用</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">框架 --&gt; 把项目开发中常用功能和样板代码全部都封装好了，你可以专注于核心问题，</span><br><span class="line">而不要再次编写重复的样板代码，重复的去实现之前已经实现过无数次的功能。</span><br><span class="line"></span><br><span class="line">PySpider</span><br><span class="line"></span><br><span class="line">Scrapy --&gt; 命令行工具 --&gt; 创建爬虫项目</span><br><span class="line">    - 安装：pip install scrapy</span><br><span class="line">    - 创建Scrapy项目：scrapy startproject demo</span><br><span class="line">    - 创建一个蜘蛛：scrapy genspider douban movie.douban.com</span><br><span class="line">    - 修改配置文件：</span><br><span class="line">        - USER-AGENT</span><br><span class="line">        - DOWNLOAD_DELAY</span><br><span class="line">        -CONCURRENT_REQUESTS</span><br><span class="line">    - 运行一个蜘蛛：scrapy crawl douban</span><br><span class="line">        - scrapy crawl douban -o douban.csv</span><br><span class="line">        - scrapy crawl douban -o douban.json</span><br></pre></td></tr></table></figure>

<p><img src="E:\QianFeng\教学资料\文件资料pdf\2阶段\网络请求.png"></p>
<p><img src="E:\QianFeng\教学资料\文件资料pdf\2阶段\请求网络的状态.jpg"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://lxmy.top/2021/09/13/stage2/2-2%20(9)/" data-id="ckthx4uov0015xcucfcn32nia" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-stage2/2-2 (8)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/13/stage2/2-2%20(8)/" class="article-date">
  <time class="dt-published" datetime="2021-09-13T00:36:53.729Z" itemprop="datePublished">2021-09-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="方案1：直接使用多线程"><a href="#方案1：直接使用多线程" class="headerlink" title="方案1：直接使用多线程"></a>方案1：直接使用多线程</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.1直接使用thread</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span>(<span class="params">num</span>):</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;子线程任务<span class="subst">&#123;num&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t = Thread(target=func1, args=(<span class="number">1</span>,))</span><br><span class="line">t.start()</span><br><span class="line"><span class="comment"># join中的timeout是设置最长等待时间,如果超时子线程的任务还没有完成,那么后面的代码会直接执行</span></span><br><span class="line">t.join(timeout=<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;线程任务完成&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.2使用thread类的子类</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FThread</span>(<span class="params">Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.num = num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;子线程任务<span class="subst">&#123;self.num&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t = FThread(<span class="number">1</span>)</span><br><span class="line">t.start()</span><br><span class="line">t.join()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;任务完成&quot;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="方案2-直接使用多进程"><a href="#方案2-直接使用多进程" class="headerlink" title="方案2.直接使用多进程"></a>方案2.直接使用多进程</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span>(<span class="params">num</span>):</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;子进程任务<span class="subst">&#123;num&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FProcess</span>(<span class="params">Process</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.num = num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;子进程任务<span class="subst">&#123;self.num&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p = Process(target=func1, args=(<span class="number">1</span>,))</span><br><span class="line">    p.start()</span><br><span class="line">    <span class="comment"># p.join()</span></span><br><span class="line">    <span class="comment"># print(&quot;进程任务完成&quot;)</span></span><br><span class="line"></span><br><span class="line">    p2 = FProcess(<span class="number">2</span>)</span><br><span class="line">    p2.start()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方案一,方案二数据获取问题：直接使用多线程,多进程的数据获取问题</span></span><br><span class="line"><span class="comment"># 1.数据跨线程：定义全局变量,直接获取相关数据;(如果要使用全局队列,可以用线程队列:queue模块中的Queue)</span></span><br><span class="line"><span class="comment"># 2.数据跨进程：只能使用进程队列(multiprocessing模块中的Queue)</span></span><br><span class="line"><span class="comment"># 3.线程队列和进程队列用法的区别</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">线程队列:</span></span><br><span class="line"><span class="string">1)定义全局队列对象</span></span><br><span class="line"><span class="string">2)添加数据:队列对象.put(数据)</span></span><br><span class="line"><span class="string">3)获取数据:队列对象.get() / 队列对象.get(timeout=超时时间)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">进程队列:</span></span><br><span class="line"><span class="string">1)定义全局队列对象</span></span><br><span class="line"><span class="string">2)添加数据:队列对象.put(数据)</span></span><br><span class="line"><span class="string">3)获取数据:队列对象.get() / 队列对象.get(timeout=超时时间)</span></span><br><span class="line"><span class="string">注意:队列对象在子进程中使用的时候必须通过进程任务对应的函数的参数来传递</span></span><br></pre></td></tr></table></figure>

<h1 id="方案3：使用线程池"><a href="#方案3：使用线程池" class="headerlink" title="方案3：使用线程池"></a>方案3：使用线程池</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, wait, as_completed, ALL_COMPLETED</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span>(<span class="params">num</span>):</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;子线程任务<span class="subst">&#123;num&#125;</span>完成&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;子线程任务<span class="subst">&#123;num&#125;</span>的数据&#x27;</span></span><br><span class="line"><span class="comment"># 创建线程池</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pool = ThreadPoolExecutor(max_workers=<span class="number">10</span>)</span><br><span class="line"><span class="comment"># 添加任务</span></span><br><span class="line"><span class="comment"># pool.submit(func1, 1)</span></span><br><span class="line"><span class="comment"># for x in range(2, 6):</span></span><br><span class="line"><span class="comment">#     pool.submit(func1, x)</span></span><br><span class="line">ts = [pool.submit(func1, x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">50</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># pool.shutdown() - 关闭线程池不在往里面加入任务,不影响已经提交的任务的执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 单纯的等待线程池中所有的任务完成</span></span><br><span class="line"><span class="comment"># wait(ts, return_when=ALL_COMPLETED)</span></span><br><span class="line"><span class="comment"># print(&quot;----------所有的任务都完成了-----------&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.等待任务完成的过程中实时获取数据</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> as_completed(ts):</span><br><span class="line">    <span class="built_in">print</span>(t.result())</span><br></pre></td></tr></table></figure>

<h1 id="方案4：进程池"><a href="#方案4：进程池" class="headerlink" title="方案4：进程池"></a>方案4：进程池</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span>(<span class="params">num</span>):</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;子进程任务<span class="subst">&#123;num&#125;</span>开始&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;子进程任务<span class="subst">&#123;num&#125;</span>的数据&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 1.创建进程池对象</span></span><br><span class="line">    pool = Pool(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.添加任务</span></span><br><span class="line">    <span class="comment"># 1)同步添加 - 任务和主进程中的其它任务串行执行</span></span><br><span class="line">    <span class="comment"># result1 = pool.apply(func1, (0,))</span></span><br><span class="line">    <span class="comment"># result2 = pool.map(func1, [1, 2, 3, 4])</span></span><br><span class="line">    <span class="comment"># print(result1)</span></span><br><span class="line">    <span class="comment"># print(result2)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2)异步添加</span></span><br><span class="line">    <span class="comment"># result = pool.apply_async(func1, (6,))</span></span><br><span class="line">    <span class="comment"># result2 = pool.map_async(func1, [1, 2, 3, 4, 5])</span></span><br><span class="line">    <span class="comment"># # 3.关闭进程池</span></span><br><span class="line">    <span class="comment"># pool.close()</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># # 4.等待进程池中的任务都结束</span></span><br><span class="line">    <span class="comment"># pool.join()</span></span><br><span class="line">    <span class="comment"># print(result.get())</span></span><br><span class="line">    <span class="comment"># print(result2.get())</span></span><br></pre></td></tr></table></figure>

<h1 id="实战51-job详情页"><a href="#实战51-job详情页" class="headerlink" title="实战51 job详情页"></a>实战51 job详情页</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, as_completed, wait, ALL_COMPLETED</span><br><span class="line"><span class="keyword">import</span> requests, json, csv</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> findall</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span>(<span class="params">page: <span class="built_in">int</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;获取一页岗位信息&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 获取数据</span></span><br><span class="line">    url = <span class="string">f&#x27;https://search.51job.com/list/000000,000000,0000,00,9,99,数据分析,2,<span class="subst">&#123;page&#125;</span>.html?lang=c&amp;postchannel=0000&amp;workyear=99&amp;cotype=99&amp;degreefrom=99&amp;jobterm=99&amp;companysize=99&amp;ord_field=0&amp;dibiaoid=0&amp;line=&amp;welfare=&#x27;</span></span><br><span class="line">    response = requests.get(url, headers=headers)</span><br><span class="line">    json_data = json.loads(findall(<span class="string">r&#x27;window.__SEARCH_RESULT__ = (.+?)&lt;/script&gt;&#x27;</span>, response.text)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解析数据</span></span><br><span class="line">    page_data = []</span><br><span class="line">    <span class="keyword">for</span> job <span class="keyword">in</span> json_data[<span class="string">&#x27;engine_search_result&#x27;</span>]:</span><br><span class="line">        job_data = &#123;&#125;</span><br><span class="line">        <span class="comment"># 获取岗位相关信息</span></span><br><span class="line">        job_data[<span class="string">&#x27;name&#x27;</span>] = job[<span class="string">&#x27;job_name&#x27;</span>]</span><br><span class="line">        job_data[<span class="string">&#x27;providesalary_text&#x27;</span>] = job[<span class="string">&#x27;providesalary_text&#x27;</span>]</span><br><span class="line">        job_data[<span class="string">&#x27;workarea_text&#x27;</span>] = job[<span class="string">&#x27;workarea_text&#x27;</span>]</span><br><span class="line">        job_data[<span class="string">&#x27;company_name&#x27;</span>] = job[<span class="string">&#x27;company_name&#x27;</span>]</span><br><span class="line">        job_data[<span class="string">&#x27;companytype_text&#x27;</span>] = job[<span class="string">&#x27;companytype_text&#x27;</span>]</span><br><span class="line">        job_data[<span class="string">&#x27;workarea_text&#x27;</span>] = job[<span class="string">&#x27;workarea_text&#x27;</span>]</span><br><span class="line">        job_data[<span class="string">&#x27;job_href&#x27;</span>] = job[<span class="string">&#x27;job_href&#x27;</span>]</span><br><span class="line">        job_data[<span class="string">&#x27;jobwelf&#x27;</span>] = job[<span class="string">&#x27;jobwelf&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将工资信息中的金额分离，并且将单位统一转换成元</span></span><br><span class="line">        salary = findall(<span class="string">r&#x27;(\d+\.?\d*)-?(\d+\.?\d*)([万千])/([月年天])&#x27;</span>, job_data[<span class="string">&#x27;providesalary_text&#x27;</span>])</span><br><span class="line">        <span class="keyword">if</span> salary:</span><br><span class="line">            salary = salary[<span class="number">0</span>]</span><br><span class="line">            unit = salary[<span class="number">2</span>]</span><br><span class="line">            time = salary[<span class="number">3</span>]</span><br><span class="line">            min_salary = (<span class="built_in">float</span>(salary[<span class="number">0</span>]) * (<span class="number">10000</span> <span class="keyword">if</span> unit == <span class="string">&#x27;万&#x27;</span> <span class="keyword">else</span> <span class="number">1000</span>)) / (<span class="number">1</span> <span class="keyword">if</span> time == <span class="string">&#x27;月&#x27;</span> <span class="keyword">else</span> <span class="number">12</span>)</span><br><span class="line">            max_salary = (<span class="built_in">float</span>(salary[<span class="number">1</span>]) * (<span class="number">10000</span> <span class="keyword">if</span> unit == <span class="string">&#x27;万&#x27;</span> <span class="keyword">else</span> <span class="number">1000</span>)) / (<span class="number">1</span> <span class="keyword">if</span> time == <span class="string">&#x27;月&#x27;</span> <span class="keyword">else</span> <span class="number">12</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            min_salary = max_salary = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        job_data[<span class="string">&#x27;min_salary&#x27;</span>] = min_salary</span><br><span class="line">        job_data[<span class="string">&#x27;max_salary&#x27;</span>] = max_salary</span><br><span class="line">        job_data[<span class="string">&#x27;salary&#x27;</span>] = (min_salary + max_salary) / <span class="number">2</span></span><br><span class="line">        page_data.append(job_data)</span><br><span class="line">    <span class="keyword">return</span> page_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取每个工作的详情页(模拟)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_details_page</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;请求工作的详情页：<span class="subst">&#123;data[<span class="string">&quot;job_href&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;-----------------请求成功!------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># response = requests.get(data[&quot;job_href&quot;])</span></span><br><span class="line">    <span class="comment"># response.text</span></span><br><span class="line">    <span class="comment"># data[&#x27;详情页信息字段&#x27;] = 详情页解析出的相关数据</span></span><br><span class="line">    data[<span class="string">&#x27;详情页&#x27;</span>] = <span class="string">&#x27;详情页数据&#x27;</span></span><br><span class="line">    queue.put(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_data</span>():</span></span><br><span class="line"></span><br><span class="line">    writer = csv.DictWriter(</span><br><span class="line">        <span class="built_in">open</span>(<span class="string">&#x27;files/数据分析.csv&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>),</span><br><span class="line">        [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;providesalary_text&#x27;</span>, <span class="string">&#x27;workarea_text&#x27;</span>, <span class="string">&#x27;company_name&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;companytype_text&#x27;</span>, <span class="string">&#x27;workarea_text&#x27;</span>, <span class="string">&#x27;job_href&#x27;</span>, <span class="string">&#x27;jobwelf&#x27;</span>, <span class="string">&#x27;min_salary&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;max_salary&#x27;</span>, <span class="string">&#x27;salary&#x27;</span>, <span class="string">&#x27;详情页&#x27;</span>]</span><br><span class="line">    )</span><br><span class="line">    writer.writeheader()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = queue.get()</span><br><span class="line">        <span class="keyword">if</span> data == <span class="string">&#x27;end&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        writer.writerow(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 1.创建线程池请求每个工作的详情页</span></span><br><span class="line">    pool2 = ThreadPoolExecutor(<span class="number">50</span>)</span><br><span class="line">    ts2 = []</span><br><span class="line"></span><br><span class="line">    queue = Queue()</span><br><span class="line">    save_thread = Thread(target=save_data)</span><br><span class="line">    save_thread.start()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.创建线程池请求搜索结果的每一页数据</span></span><br><span class="line">    pool1 = ThreadPoolExecutor(<span class="number">50</span>)</span><br><span class="line">    ts = [pool1.submit(get_one_page, page) <span class="keyword">for</span> page <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">101</span>)]</span><br><span class="line">    pool1.shutdown()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.如果请求到一个数据，就将一页数据中的50个岗位的详情请求作为任务添加到pool2中</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> as_completed(ts):</span><br><span class="line">        <span class="keyword">for</span> job <span class="keyword">in</span> t.result():</span><br><span class="line">            <span class="built_in">print</span>(job[<span class="string">&#x27;job_href&#x27;</span>])</span><br><span class="line">            t2 = pool2.submit(get_details_page, job)</span><br><span class="line">            ts2.append(t2)</span><br><span class="line">    pool2.shutdown()</span><br><span class="line"></span><br><span class="line">    wait(ts2, return_when=ALL_COMPLETED)</span><br><span class="line">    queue.put(<span class="string">&#x27;end&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;----------------------------------全部结束-----------------------------&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="京东商品评论"><a href="#京东商品评论" class="headerlink" title="京东商品评论"></a>京东商品评论</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> findall</span><br><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> loads</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, wait, ALL_COMPLETED, as_completed</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;cookie&#x27;</span>: <span class="string">&#x27;__jdv=76161171|direct|-|none|-|1628560053224; __jdu=16285600532191992332185; shshshfpb=l7hwQrGrqIi4eCr58XglTaQ%3D%3D; shshshfpa=6f4d3f44-5d90-7676-86d0-e6c4df742265-1617089801; user-key=478b38e2-62c2-4780-abdc-7ee92a3a8757; pinId=vgq34oMxHnsjt7JTMb9B0A; pin=15300022703_p; unick=jd153000xiz; _tp=SS6A2kOuyFHrS5Nm%2BHtauA%3D%3D; _pst=15300022703_p; qrsc=3; areaId=22; ipLoc-djd=22-1930-50947-0; PCSYCityID=CN_510000_510100_510107; rkv=1.0; TrackID=1erZ0XUO8xw_6hUL-f2Hc_nktnWuiTcO4mpb6IvZqKkILGf2FhGrEnjJXwSsmjbmZDcgSFyPaBnzaWacgmu38rV1O4_-kXXn13bNGTCAY6qQ8UbWIlrn9D4FEAlJ2l4Tc; thor=CCB112E41BF7B8A18299559069E1826B2FE40F79A9C40AB9CF6C7ACF4FE9B0D189CA2691BCCB844F401D55F533423E22D93DB74BC974DE5CBAD06E96E66DC8968A44F9A96268E9F0FDC91512405DD5D2CA092862CB2AA3D051F92E8B9714C2A9F110FBDA52F37F63703ECAFFD70A5E993920298C08ABB5DEC447DD3F4611CAE31BB210BC0953C98497CFCDD5B086F499; ceshi3.com=201; 3AB9D23F7A4B3C9B=MBL5WIIFBJTQE7QBGVZP75S4LKWL4F6HAICGTLHP5C7ASWPR3ARXWOZP5CCBRG5MWZV2B7IB6VAIGDPHH4XMIDMXGI; __jda=122270672.16285600532191992332185.1628560053.1628838707.1629443811.8; __jdb=122270672.8.16285600532191992332185|8.1629443811; __jdc=122270672; shshshfp=3e4645d35360fc979933ecbd8a88e64d; shshshsID=d26b51263e90f337994443223e764969_5_1629444224406&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_goods_list</span>(<span class="params">page</span>):</span></span><br><span class="line">    url = <span class="string">f&#x27;https://search.jd.com/Search?keyword=%E7%94%B5%E8%84%91&amp;wq=%E7%94%B5%E8%84%91&amp;pvid=f1269a60000642a7bdda4078a12138d6&amp;page=<span class="subst">&#123;page&#125;</span>&amp;s=56&amp;click=0&#x27;</span></span><br><span class="line">    response = requests.get(url, headers=headers)</span><br><span class="line">    soup = BeautifulSoup(response.text, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">    all_goods_li = soup.select(<span class="string">&#x27;.gl-warp&gt;li&#x27;</span>)</span><br><span class="line">    all_goods_id = []</span><br><span class="line">    <span class="keyword">for</span> goods_li <span class="keyword">in</span> all_goods_li:</span><br><span class="line">        all_goods_id.append(goods_li.attrs[<span class="string">&#x27;data-sku&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> all_goods_id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page_comments</span>(<span class="params">goods_id: <span class="built_in">str</span>, page: <span class="built_in">int</span></span>):</span></span><br><span class="line">    url = <span class="string">f&#x27;https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98&amp;productId=<span class="subst">&#123;goods_id&#125;</span>&amp;score=0&amp;sortType=5&amp;page=<span class="subst">&#123;page&#125;</span>&amp;pageSize=10&amp;isShadowSku=0&amp;fold=1&#x27;</span></span><br><span class="line">    response = requests.get(url, headers=headers)</span><br><span class="line">    json_str = findall(<span class="string">r&#x27;fetchJSON_comment98\((.+)\)&#x27;</span>, response.text)[<span class="number">0</span>]</span><br><span class="line">    comment_info = loads(json_str)</span><br><span class="line">    comments = comment_info[<span class="string">&#x27;comments&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> comments:</span><br><span class="line">        <span class="built_in">print</span>(x[<span class="string">&#x27;content&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_goods_comments</span>(<span class="params">goods_id: <span class="built_in">str</span></span>):</span></span><br><span class="line">    url = <span class="string">f&#x27;https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98&amp;productId=<span class="subst">&#123;goods_id&#125;</span>&amp;score=0&amp;sortType=5&amp;page=1&amp;pageSize=10&amp;isShadowSku=0&amp;fold=1&#x27;</span></span><br><span class="line">    response = requests.get(url, headers=headers)</span><br><span class="line">    json_str = findall(<span class="string">r&#x27;fetchJSON_comment98\((.+)\)&#x27;</span>, response.text)[<span class="number">0</span>]</span><br><span class="line">    comment_info = loads(json_str)</span><br><span class="line">    comment_summary = comment_info[<span class="string">&#x27;productCommentSummary&#x27;</span>]</span><br><span class="line">    count = reduce(<span class="keyword">lambda</span> x, y: x+comment_summary[<span class="string">f&#x27;score<span class="subst">&#123;y&#125;</span>Count&#x27;</span>], <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>), <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(count//<span class="number">10</span>+<span class="number">1</span>):</span><br><span class="line">        t = pool.submit(get_one_page_comments, goods_id, x)</span><br><span class="line">        ts.append(t)</span><br><span class="line"></span><br><span class="line">    pool.shutdown()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 获取评论信息的线程池</span></span><br><span class="line">    pool = ThreadPoolExecutor(<span class="number">50</span>)</span><br><span class="line">    ts = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取数据</span></span><br><span class="line">    all_goods_id = get_goods_list(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(all_goods_id)</span><br><span class="line">    get_goods_comments(all_goods_id[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    wait(ts, return_when=ALL_COMPLETED)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://lxmy.top/2021/09/13/stage2/2-2%20(8)/" data-id="ckthx4uow0017xcuc15slgmho" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-stage2/2-2 (7)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/13/stage2/2-2%20(7)/" class="article-date">
  <time class="dt-published" datetime="2021-09-13T00:36:53.727Z" itemprop="datePublished">2021-09-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1-线程队列"><a href="#1-线程队列" class="headerlink" title="1.线程队列"></a>1.线程队列</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"></span><br><span class="line"><span class="comment"># queue模块中的队列,只能保存一般数据或者多线程中产生的数据(多用于多线程,自带安全属性)</span></span><br><span class="line"><span class="comment"># 但是不能用来存储多进程中产生的数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 1.队列的基本用法</span></span><br><span class="line">    <span class="comment"># 1)创建队列对象:Queue()</span></span><br><span class="line">    q = Queue()</span><br><span class="line">    <span class="comment"># 2)添加数据(进)(先进先出)队列对象.put(数据)</span></span><br><span class="line">    q.put(<span class="number">100</span>)</span><br><span class="line">    q.put(<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3)获取数据(出): - 出一个少一个:队列对象.get()</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;个数&quot;</span>, q.qsize())</span><br><span class="line">    <span class="built_in">print</span>(q.get())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;个数&quot;</span>, q.qsize())</span><br><span class="line">    <span class="built_in">print</span>(q.get())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;个数&quot;</span>, q.qsize())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4) 获取队列中元素的个数:队列对象.qsize()</span></span><br><span class="line">    <span class="comment"># 5) 通过get获取数据的时候如果队列中没有数据,get方法会等待,直到队列中有数据,或者超时为止</span></span><br><span class="line">    <span class="comment"># 队列对象.get(timeout=n)</span></span><br><span class="line">    <span class="comment"># q.get()</span></span><br><span class="line">    q.get(timeout=<span class="number">3</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="2-队列在多线程中的用法"><a href="#2-队列在多线程中的用法" class="headerlink" title="2.队列在多线程中的用法"></a>2.队列在多线程中的用法</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue, Empty</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>开始下载&#x27;</span>)</span><br><span class="line">    time.sleep(randint(<span class="number">1</span>, <span class="number">10</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>下载结束&#x27;</span>)</span><br><span class="line">    q.put(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>数据&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">del_data</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = q.get()</span><br><span class="line">        <span class="keyword">if</span> data == <span class="string">&#x27;end&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;------------处理<span class="subst">&#123;data&#125;</span>------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    q = Queue()</span><br><span class="line">    <span class="comment"># 创建子线程下载数据</span></span><br><span class="line">    names = [<span class="string">f&#x27;电影<span class="subst">&#123;x&#125;</span>&#x27;</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>)]</span><br><span class="line">    ts = []</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">        t = Thread(target=download, args=(name,))</span><br><span class="line">        t.start()</span><br><span class="line">        ts.append(t)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建一个线程处理数据</span></span><br><span class="line">    dl_t = Thread(target=del_data)</span><br><span class="line">    dl_t.start()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1.获取队列数据方式1:能做到子线程得到数据</span></span><br><span class="line">    <span class="comment"># 主线程马上处理数据,但是数据处理完程序没法结束</span></span><br><span class="line">    <span class="comment"># while True:</span></span><br><span class="line">    <span class="comment">#     data = q.get()</span></span><br><span class="line">    <span class="comment">#     print(f&#x27;------------处理&#123;data&#125;------------&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.获取队列数据方式2:能做到子线程得到数据</span></span><br><span class="line">    <span class="comment">#   主线程马上处理数据,并且通过超时,判断数据是否处理完成</span></span><br><span class="line">    <span class="comment"># while True:</span></span><br><span class="line">    <span class="comment">#     try:</span></span><br><span class="line">    <span class="comment">#         data = q.get(timeout=5)</span></span><br><span class="line">    <span class="comment">#         print(f&#x27;------------处理&#123;data&#125;------------&#x27;)</span></span><br><span class="line">    <span class="comment">#     except Empty:</span></span><br><span class="line">    <span class="comment">#         break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.在所有下载数据的线程都结束的时候在队列中添加结束标记,在子线程中去获取队列中来处理</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> ts:</span><br><span class="line">        t.join()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;全部电影下载结束&quot;</span>)</span><br><span class="line">    q.put(<span class="string">&#x27;end&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="3-队列在多进程中的用法"><a href="#3-队列在多进程中的用法" class="headerlink" title="3.队列在多进程中的用法"></a>3.队列在多进程中的用法</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Queue, current_process</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1)基本操作:</span></span><br><span class="line"><span class="string">创建队列对象: Queue()</span></span><br><span class="line"><span class="string">添加数据:队列对象.put(数据)</span></span><br><span class="line"><span class="string">获取数据:队列对象.get() /队列对象.get(timeout=超时时间)</span></span><br><span class="line"><span class="string">2)注意事项:</span></span><br><span class="line"><span class="string">如果想要使用一个队列对象获取不同进程中的数据，这个队列必须通过关联进程的函数的参数传递到进程中</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">#练习:使用多个进程同时下载多个电影，将下载的电影数据保存到队列中，在一 个新的进程中去处理下载到的数据</span></span><br><span class="line"><span class="string">#做到:边下载边处理， 下载完就处理完，处理完程序马上结束</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download</span>(<span class="params">name, que: Queue</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>开始下载&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;下载:&#x27;</span>, current_process())</span><br><span class="line">    time.sleep(randint(<span class="number">2</span>, <span class="number">7</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>下载结束&#x27;</span>)</span><br><span class="line">    que.put(name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">del_data</span>(<span class="params">que:Queue</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = que.get()</span><br><span class="line">        <span class="keyword">if</span> data == <span class="string">&#x27;end&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;------------处理<span class="subst">&#123;data&#125;</span>------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    que = Queue()</span><br><span class="line">    <span class="comment"># 创建进程下载数据</span></span><br><span class="line">    names = [<span class="string">f&#x27;电影<span class="subst">&#123;x&#125;</span>&#x27;</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>)]</span><br><span class="line">    ts = []</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">        p = Process(target=download, args=(name, que))</span><br><span class="line">        p.start()</span><br><span class="line">        ts.append(p)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建一个进程处理数据</span></span><br><span class="line">    dl_t = Process(target=del_data, args=(que,))</span><br><span class="line">    dl_t.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> ts:</span><br><span class="line">        t.join()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;全部电影下载结束&quot;</span>)</span><br><span class="line">    que.put(<span class="string">&#x27;end&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="4-线程池"><a href="#4-线程池" class="headerlink" title="4.线程池"></a>4.线程池</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"><span class="comment"># from random import randint</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment"># from threading import current_thread</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>开始下载&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)  <span class="comment"># randint(2, 7)</span></span><br><span class="line">    <span class="comment"># print(current_thread())</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>下载结束&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 线程池的工作原理:提前创建指定个数的线程,保存到一个线程池中.</span></span><br><span class="line"><span class="comment">#               然后在往线程池中添加若干个任务,线程池自动为线程分配任务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.创建线程池,确定线程池中线程的个数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pool = ThreadPoolExecutor(max_workers=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 往线程池中添加任务</span></span><br><span class="line">names = [<span class="string">f&#x27;电影<span class="subst">&#123;x&#125;</span>&#x27;</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.1 一次添加一个任务</span></span><br><span class="line"><span class="comment"># 线程池.submit(函数,参数1,参数2....)</span></span><br><span class="line"><span class="comment"># pool.submit(download, &#x27;电影0&#x27;)</span></span><br><span class="line"><span class="comment"># for name in names:</span></span><br><span class="line"><span class="comment">#     pool.submit(download, name)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.2 一次添加多个任务</span></span><br><span class="line"><span class="comment"># 线程池.map(函数, 包含所有任务的参数的序列)</span></span><br><span class="line">pool.<span class="built_in">map</span>(download, names)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 关闭线程池</span></span><br><span class="line"><span class="comment"># 不能在往线程池中添加任务  -  否则会报错  -  不影响已经添加到线程池中的任务执行</span></span><br><span class="line">pool.shutdown()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="5-线程池使用的细节"><a href="#5-线程池使用的细节" class="headerlink" title="5.线程池使用的细节"></a>5.线程池使用的细节</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, wait, ALL_COMPLETED, as_completed</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download</span>(<span class="params">name, x</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>-<span class="subst">&#123;x&#125;</span>开始下载&#x27;</span>)</span><br><span class="line">    time.sleep(randint(<span class="number">1</span>, <span class="number">4</span>))  <span class="comment">#</span></span><br><span class="line">    <span class="comment"># print(current_thread())</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>-<span class="subst">&#123;x&#125;</span>下载结束&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;电影<span class="subst">&#123;name&#125;</span>的数据&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 1.创建线程池对象</span></span><br><span class="line">    pool = ThreadPoolExecutor(max_workers=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.添加任务</span></span><br><span class="line">    <span class="comment"># 线程池.submit(函数)  -  函数可以是有任意多个参数的函数(返回值是一个可操作性的future对象)</span></span><br><span class="line">    <span class="comment"># 线程池.map(函数)  -  函数只能是有且只有一个参数的函数(返回值没法控制和操作)</span></span><br><span class="line">    f = pool.submit(download, <span class="string">&#x27;电影1&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">    names = [<span class="string">f&#x27;电影<span class="subst">&#123;x&#125;</span>&#x27;</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line">    all_task = [pool.submit(download, <span class="string">f&#x27;电影<span class="subst">&#123;x&#125;</span>&#x27;</span>, x*<span class="number">10</span>) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># all_task = []</span></span><br><span class="line">    <span class="comment"># for x in range(100):</span></span><br><span class="line">    <span class="comment">#     f = pool.submit(download, f&#x27;电影&#123;x&#125;&#x27;, x * 10)</span></span><br><span class="line">    <span class="comment">#     all_task.append(f)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 等待任务完成</span></span><br><span class="line">    <span class="comment"># wait(all_task, return_when=ALL_COMPLETED)</span></span><br><span class="line">    <span class="comment"># print(&quot;----------------电影下载完成--------------------&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. 获取任务函数的返回值</span></span><br><span class="line">    <span class="keyword">for</span> task <span class="keyword">in</span> as_completed(all_task):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;-------------<span class="subst">&#123;task.result()&#125;</span>------------&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="6-进程池"><a href="#6-进程池" class="headerlink" title="6.进程池"></a>6.进程池</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>开始下载&#x27;</span>)</span><br><span class="line">    time.sleep(randint(<span class="number">1</span>, <span class="number">4</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>下载结束&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>数据&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 1.创建进程池对象:Pool(进程数)</span></span><br><span class="line">    pool = Pool(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.添加任务</span></span><br><span class="line">    <span class="comment"># 1)一次添加一个任务</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    a.进程池对象.apply(函数，参数) - 同步(串行)；进程池中的多个任务串行执行</span></span><br><span class="line"><span class="string">    b.进程池对象.apply_async(函数，参数) - 异步(并行)；必须配合close和join一起用</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    函数 - 任务对应的函数的函数名</span></span><br><span class="line"><span class="string">    参数 - 元组；调用任务函数的时候的实参，需要多少个实参，元组中就给多少个元素</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># pool.apply(download, (&#x27;电影1&#x27;, 10))</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># for x in range(20):</span></span><br><span class="line">    <span class="comment">#     pool.apply_async(download, (f&#x27;电影&#123;x&#125;&#x27;,))</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2)同时添加多个任务</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    进程池.map(函数,参数序列) - 序列中有多少个元素就添加多少个任务；进程池中的任务并行，进程池中的任务和主进程串行</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    进程池.map_async(函数,参数) - 进程池中的任务和主进程并行执行</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    map和map_async的返回值是所有任务对应的函数的返回值</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    result = pool.map_async(download, [(<span class="string">f&#x27;电影<span class="subst">&#123;x&#125;</span>&#x27;</span>, x*<span class="number">10</span>) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">    <span class="comment"># print(&#x27;----------主进程---------&#x27;)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># # 3.关闭进程池，阻止往进程池中添加新的任务</span></span><br><span class="line">    pool.close()</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># # 4.等待进程池中的任务都结束</span></span><br><span class="line">    pool.join()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;-----------下载完成------------&#x27;</span>)</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># # 获取函数返回值</span></span><br><span class="line">    <span class="comment"># print(result.get())</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="线程池实例-51-job"><a href="#线程池实例-51-job" class="headerlink" title="线程池实例 51 job"></a>线程池实例 51 job</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> findall</span><br><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> loads</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, as_completed, wait</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span>(<span class="params">page</span>):</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    url = <span class="string">f&#x27;https://search.51job.com/list/000000,000000,0000,00,9,99,python,2,<span class="subst">&#123;page&#125;</span>.html?lang=c&amp;postchannel=0000&amp;workyear=99&amp;cotype=99&amp;degreefrom=99&amp;jobterm=99&amp;companysize=99&amp;ord_field=0&amp;dibiaoid=0&amp;line=&amp;welfare=&#x27;</span></span><br><span class="line">    response = requests.get(url, headers=headers)</span><br><span class="line">    json_data = findall(<span class="string">r&#x27;window.__SEARCH_RESULT__ =(.+?)&lt;/script&gt;&#x27;</span>, response.text)[<span class="number">0</span>]</span><br><span class="line">    dict_data = loads(json_data)</span><br><span class="line">    page_data = []</span><br><span class="line">    <span class="keyword">for</span> job <span class="keyword">in</span> dict_data[<span class="string">&#x27;engine_search_result&#x27;</span>]:</span><br><span class="line">        page_data.append(&#123;</span><br><span class="line">            <span class="string">&#x27;工作名称&#x27;</span>: job[<span class="string">&#x27;job_name&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;工作详情&#x27;</span>: job[<span class="string">&#x27;job_href&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;薪资&#x27;</span>: job[<span class="string">&#x27;providesalary_text&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;工作地点&#x27;</span>: job[<span class="string">&#x27;workarea_text&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;工作年限&#x27;</span>: job[<span class="string">&#x27;workyear&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;福利待遇&#x27;</span>: job[<span class="string">&#x27;jobwelf&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;公司&#x27;</span>: job[<span class="string">&#x27;company_name&#x27;</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="comment"># print(page_data)</span></span><br><span class="line">    <span class="keyword">return</span> page_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. 使用线程池下载数据</span></span><br><span class="line">    pool = ThreadPoolExecutor(<span class="number">20</span>)</span><br><span class="line">    all_task = [pool.submit(get_one_page, page) <span class="keyword">for</span> page <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">101</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 在主线程处理数据</span></span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;files/51job.csv&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>, newline=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    writer = csv.DictWriter(f, [<span class="string">&#x27;工作名称&#x27;</span>, <span class="string">&#x27;工作详情&#x27;</span>, <span class="string">&#x27;薪资&#x27;</span>, <span class="string">&#x27;工作地点&#x27;</span>, <span class="string">&#x27;工作年限&#x27;</span>, <span class="string">&#x27;福利待遇&#x27;</span>, <span class="string">&#x27;公司&#x27;</span>])</span><br><span class="line">    writer.writeheader()</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> as_completed(all_task):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;----------处理一页数据---------&#x27;</span>)</span><br><span class="line">        writer.writerows(t.result())</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://lxmy.top/2021/09/13/stage2/2-2%20(7)/" data-id="ckthx4uou0014xcuc8kw410e7" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-stage2/2-2 (6)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/13/stage2/2-2%20(6)/" class="article-date">
  <time class="dt-published" datetime="2021-09-13T00:36:53.723Z" itemprop="datePublished">2021-09-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1-多线程"><a href="#1-多线程" class="headerlink" title="1. 多线程"></a>1. 多线程</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, current_thread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序默认都是单线程(这个默认线程又叫主线程)</span></span><br><span class="line"><span class="comment"># Thread类的对象就是线程对象,程序需要多少个子线程,就创建多少个Thread的对象</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>开始下载:<span class="subst">&#123;datetime.now()&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;当前线程:&#x27;</span>, current_thread())</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>下载结束:<span class="subst">&#123;datetime.now()&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.单线程下载三部电影</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># download(&#x27;大话西游&#x27;)</span></span><br><span class="line"><span class="comment"># download(&#x27;忍者神龟&#x27;)</span></span><br><span class="line"><span class="comment"># download(&#x27;狐妖&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.多线程下载三部电影</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">创建子线程</span></span><br><span class="line"><span class="string">Thread(target=函数,args=元组)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">函数  -  需要在子线程中调用的函数</span></span><br><span class="line"><span class="string">元组  -  在target调用对应的函数的时候传递实参列表</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 1)创建线程对象 - 启动线程(线程对象.start())</span></span><br><span class="line">t1 = Thread(target=download, args=(<span class="string">&#x27;大话西游&#x27;</span>,))</span><br><span class="line">t1.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t2 = Thread(target=download, args=(<span class="string">&#x27;忍者神龟&#x27;</span>,))</span><br><span class="line">t2.start()</span><br><span class="line"></span><br><span class="line">t3 = Thread(target=download, args=(<span class="string">&#x27;狐妖&#x27;</span>,))</span><br><span class="line">t3.start()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="2-实例千图网图片下载多线程"><a href="#2-实例千图网图片下载多线程" class="headerlink" title="2. 实例千图网图片下载多线程"></a>2. 实例千图网图片下载多线程</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span>(<span class="params">page: <span class="built_in">int</span></span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;获取第<span class="subst">&#123;page&#125;</span>页数据&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> page == <span class="number">1</span>:</span><br><span class="line">        url = <span class="string">&#x27;https://pic.netbian.com/index.html&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        url = <span class="string">f&#x27;https://pic.netbian.com/index_<span class="subst">&#123;page&#125;</span>.html&#x27;</span></span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    response.encoding = <span class="string">&#x27;gbk&#x27;</span></span><br><span class="line">    html = etree.HTML(response.text)</span><br><span class="line">    result = html.xpath(<span class="string">&#x27;//div[@class=&quot;slist&quot;]/ul/li/a/img/@src|//div[@class=&quot;slist&quot;]/ul/li/a/span/img/@src&#x27;</span>)</span><br><span class="line">    <span class="comment"># return [&#x27;https://pic.netbian.com&#x27;+x for x in result]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#  一页图片用一个线程来下载</span></span><br><span class="line">    t = Thread(target=download_page_image, args=([<span class="string">&#x27;https://pic.netbian.com&#x27;</span>+x <span class="keyword">for</span> x <span class="keyword">in</span> result],))</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 一张图片一个线程</span></span><br><span class="line">    <span class="comment"># for url in [&#x27;https://pic.netbian.com&#x27;+x for x in result]:</span></span><br><span class="line">    <span class="comment">#     t = Thread(target=download_image, args=(url,))</span></span><br><span class="line">    <span class="comment">#     t.start()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_all_data</span>():</span></span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">        t = Thread(target=get_one_page, args=(page, ))</span><br><span class="line">        t.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_page_image</span>(<span class="params">urls: <span class="built_in">list</span></span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;下载一页数据:<span class="subst">&#123;<span class="built_in">len</span>(urls)&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">        download_image(url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_image</span>(<span class="params">url: <span class="built_in">str</span></span>):</span></span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">f&#x27;files/<span class="subst">&#123;url.split(<span class="string">&quot;/&quot;</span>)[-<span class="number">1</span>]&#125;</span>&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">    f.write(response.content)</span><br><span class="line">    <span class="comment"># print(&#x27;下载完成！&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">get_all_data()</span><br></pre></td></tr></table></figure>



<h1 id="3-线程类的子类对象"><a href="#3-线程类的子类对象" class="headerlink" title="3. 线程类的子类对象"></a>3. 线程类的子类对象</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, current_thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DownloadThread</span>(<span class="params">Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在子线程中添加任务</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;self.name&#125;</span>开始下载：<span class="subst">&#123;datetime.now()&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;当前线程：&#x27;</span>, current_thread())</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;self.name&#125;</span>下载结束：<span class="subst">&#123;datetime.now()&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = DownloadThread(<span class="string">&#x27;奥特曼&#x27;</span>)</span><br><span class="line">t2 = DownloadThread(<span class="string">&#x27;葫芦娃&#x27;</span>)</span><br><span class="line">t3 = DownloadThread(<span class="string">&#x27;金刚&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过start调用run，run方法会在相应的子线程中执行</span></span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line">t3.start()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接调用run，run方法会在主线程中执行</span></span><br><span class="line"><span class="comment"># t1.run()</span></span><br><span class="line"><span class="comment"># t2.run()</span></span><br><span class="line"><span class="comment"># t3.run()</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="4-join操作"><a href="#4-join操作" class="headerlink" title="4. join操作"></a>4. join操作</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, current_thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DownloadThread</span>(<span class="params">Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在子线程中添加任务</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;self.name&#125;</span>开始下载：<span class="subst">&#123;datetime.now()&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;当前线程：&#x27;</span>, current_thread())</span><br><span class="line">        time.sleep(randint(<span class="number">3</span>, <span class="number">7</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;self.name&#125;</span>下载结束：<span class="subst">&#123;datetime.now()&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = DownloadThread(<span class="string">&#x27;奥特曼&#x27;</span>)</span><br><span class="line">t2 = DownloadThread(<span class="string">&#x27;葫芦娃&#x27;</span>)</span><br><span class="line">t3 = DownloadThread(<span class="string">&#x27;金刚&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过start调用run，run方法会在相应的子线程中执行</span></span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line">t3.start()</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">join 的用法：</span></span><br><span class="line"><span class="string">线程对象.join()  -  等待当前线程的任务结束后才执行后面的代码</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">t1.join()</span><br><span class="line">t2.join()</span><br><span class="line">t3.join()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;电影全部下载结束&quot;</span>)</span><br></pre></td></tr></table></figure>



<h1 id="5-多进程"><a href="#5-多进程" class="headerlink" title="5.多进程"></a>5.多进程</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, current_process</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>开始下载：<span class="subst">&#123;datetime.now()&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;当前线程：&#x27;</span>, current_process())</span><br><span class="line">    time.sleep(randint(<span class="number">3</span>, <span class="number">7</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>下载结束：<span class="subst">&#123;datetime.now()&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 1.创建进程对象</span></span><br><span class="line">    p1 = Process(target=download, args=(<span class="string">&#x27;肖申克的救赎&#x27;</span>,))</span><br><span class="line">    p2 = Process(target=download, args=(<span class="string">&#x27;触不可及&#x27;</span>,))</span><br><span class="line">    p3 = Process(target=download, args=(<span class="string">&#x27;肖申克的救赎&#x27;</span>,))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.启动进程</span></span><br><span class="line">    p1.start()</span><br><span class="line">    p2.start()</span><br><span class="line">    p3.start()</span><br><span class="line"></span><br><span class="line">    p1.join()</span><br><span class="line">    p2.join()</span><br><span class="line">    p3.join()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;电影下载完成！&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="6-线程间通信"><a href="#6-线程间通信" class="headerlink" title="6.线程间通信"></a>6.线程间通信</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 同一个进程里面的多个线程之间的数据可以直接相互使用</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">100</span></span><br><span class="line">list1 = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span>():</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">global</span> a</span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line">    a = <span class="number">300</span></span><br><span class="line">    list1.append(<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t = Thread(target=func1)</span><br><span class="line">t.start()</span><br><span class="line"></span><br><span class="line">t.join()</span><br><span class="line"><span class="built_in">print</span>(a, list1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.线程间通信的数据安全</span></span><br><span class="line"><span class="comment"># 加锁：一个数据一个锁(数据和锁需要对应)</span></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock,RLock</span><br><span class="line"></span><br><span class="line">balance = <span class="number">10000</span></span><br><span class="line"><span class="comment"># 1)创建锁对象,保证一个数据一个锁</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Lock对象:锁对象.acquire() -加锁; 锁对象.release() -释放锁</span></span><br><span class="line"><span class="string">RLock对象:</span></span><br><span class="line"><span class="string">with锁对象:</span></span><br><span class="line"><span class="string">    操作数据的代码</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">lock = Lock()</span><br><span class="line">lock2 = RLock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_money</span>(<span class="params">num: <span class="built_in">int</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;存钱&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;---开始存钱---&#x27;</span>)</span><br><span class="line">    <span class="comment"># 2)在使用需要锁的数据之前加锁</span></span><br><span class="line">    <span class="comment"># lock.acquire()</span></span><br><span class="line">    <span class="keyword">with</span> lock2:</span><br><span class="line">        <span class="keyword">global</span> balance</span><br><span class="line">        b1 = balance</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        balance = b1 + num</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3)在数据用完以后释放锁</span></span><br><span class="line">    <span class="comment"># lock.release()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw_money</span>(<span class="params">num: <span class="built_in">int</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;取钱&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;---开始取钱---&#x27;</span>)</span><br><span class="line">    <span class="comment"># lock.acquire()</span></span><br><span class="line">    <span class="keyword">with</span> lock2:</span><br><span class="line">        <span class="keyword">global</span> balance</span><br><span class="line">        b1 = balance</span><br><span class="line">        <span class="keyword">if</span> b1 &gt;= num:</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            balance = b1 - num</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;余额不足！&#x27;</span>)</span><br><span class="line">    <span class="comment"># lock.release()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = Thread(target=save_money, args=(<span class="number">2000</span>,))</span><br><span class="line">t2 = Thread(target=draw_money, args=(<span class="number">3000</span>,))</span><br><span class="line"></span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line"></span><br><span class="line">t1.join()</span><br><span class="line">t2.join()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;余额:&#x27;</span>, balance)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="7-多线程数据返回问题"><a href="#7-多线程数据返回问题" class="headerlink" title="7. 多线程数据返回问题"></a>7. 多线程数据返回问题</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">在子线程中调用的函数如果有返回值，这个返回值无法在任何地方获取</span></span><br><span class="line"><span class="string">在函数内部产生的新的数据 - 一般用容器保存(在线程结束之后使用)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, current_thread</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结论：在子线程中调用的函数如果有返回值，这个返回值是无法在任何地方获取</span></span><br><span class="line"></span><br><span class="line">data = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;收集数据&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;-----&#x27;</span>)</span><br><span class="line">    <span class="comment"># return f&#x27;&#123;name&#125;数据&#x27;</span></span><br><span class="line">    data.append(<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>数据&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">use_data</span>():</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> data:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;使用<span class="subst">&#123;current_thread()&#125;</span>:&#x27;</span>, x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = Thread(target=download, args=(<span class="string">&#x27;肖申克的救赎&#x27;</span>,))</span><br><span class="line">t2 = Thread(target=download, args=(<span class="string">&#x27;触不可及&#x27;</span>,))</span><br><span class="line">result1 = t1.start()</span><br><span class="line">result2 = t2.start()</span><br><span class="line"></span><br><span class="line">t1.join()</span><br><span class="line">t2.join()</span><br><span class="line"><span class="comment"># print(data)</span></span><br><span class="line"></span><br><span class="line">t3 = Thread(target=use_data())</span><br><span class="line">t3.start()</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://lxmy.top/2021/09/13/stage2/2-2%20(6)/" data-id="ckthx4uot0013xcuc43mi94uc" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-stage2/2-2 (5)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/13/stage2/2-2%20(5)/" class="article-date">
  <time class="dt-published" datetime="2021-09-13T00:36:53.720Z" itemprop="datePublished">2021-09-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1-xpath解析之xml"><a href="#1-xpath解析之xml" class="headerlink" title="1.xpath解析之xml"></a>1.xpath解析之xml</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.专业术语</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">树：整个HTML或者xml结构</span></span><br><span class="line"><span class="string">节点：HTML中的每个标签,xml中标签就是节点</span></span><br><span class="line"><span class="string">根节点：树的第一个节点，HTML的根节点就是HTML标签</span></span><br><span class="line"><span class="string">属性：节点属性（html中就是标签属性）</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.xml数据格式</span></span><br><span class="line"><span class="comment"># json数据和xml数据是两种通用的数据格式,用于不同语言之间的数据交流</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1). 准备数据</span></span><br><span class="line">xml_str = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;supermaket&gt;</span></span><br><span class="line"><span class="string">    &lt;name&gt;永辉超市&lt;/name&gt;</span></span><br><span class="line"><span class="string">    &lt;address&gt;肖家河大厦&lt;/address&gt;</span></span><br><span class="line"><span class="string">    &lt;goodslist&gt;</span></span><br><span class="line"><span class="string">        &lt;goods name=&quot;泡面&quot; price=&quot;3.5&quot; count=&quot;20&quot;&gt;&lt;/goods&gt;</span></span><br><span class="line"><span class="string">        &lt;goods name=&quot;矿泉水&quot; price=&quot;2&quot; count=&quot;50&quot;&gt;&lt;/goods&gt;</span></span><br><span class="line"><span class="string">        &lt;goods name=&quot;面包&quot; price=&quot;5&quot; count=&quot;15&quot;&gt;&lt;/goods&gt;</span></span><br><span class="line"><span class="string">    &lt;/goodslist&gt;</span></span><br><span class="line"><span class="string">    &lt;goods price=&quot;35&quot; count=&quot;20&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;name&gt;烟&lt;/name&gt;</span></span><br><span class="line"><span class="string">    &lt;/goods&gt;</span></span><br><span class="line"><span class="string">    &lt;worker_list&gt;</span></span><br><span class="line"><span class="string">        &lt;cashier name=&quot;张三&quot; pay=&quot;4000&quot;&gt;&lt;/cashier&gt;</span></span><br><span class="line"><span class="string">        &lt;shoppingGuide name=&quot;李四&quot; pay=&quot;3500&quot;&gt;&lt;/shoppingGuide&gt;</span></span><br><span class="line"><span class="string">    &lt;/worker_list&gt;</span></span><br><span class="line"><span class="string">&lt;/supermaket&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2). 创建树对象,并获取数据的根节点</span></span><br><span class="line"></span><br><span class="line">supermarket = etree.XML(xml_str)</span><br><span class="line"><span class="comment"># print(supermarket)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3). 获取节点</span></span><br><span class="line"><span class="comment"># 节点对象.xpath(路径) - 根据路径找到对应的节点,返回节点对象</span></span><br><span class="line"><span class="comment"># a.写绝对路径,不管xpath前面的节点对象是什么,路径从根节点开始写</span></span><br><span class="line"><span class="comment"># 写法:/绝对路径</span></span><br><span class="line">cashier = supermarket.xpath(<span class="string">&#x27;/supermaket/worker_list/cashier&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(cashier)  <span class="comment"># [&lt;Element cashier at 0x26a1eb29200&gt;]</span></span><br><span class="line"></span><br><span class="line">worker_list = supermarket.xpath(<span class="string">&#x27;/supermaket/worker_list&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(worker_list)  <span class="comment"># &lt;Element worker_list at 0x26a1eb29180&gt;</span></span><br><span class="line"></span><br><span class="line">result = worker_list.xpath(<span class="string">&#x27;/worker_list/cashier&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)   <span class="comment"># []</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># b.相对路径：用.来表示当前节点</span></span><br><span class="line"><span class="comment"># 注意：./可以省略</span></span><br><span class="line">cashier = supermarket.xpath(<span class="string">&#x27;./worker_list/cashier&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(cashier)  <span class="comment"># [&lt;Element cashier at 0x1a7a4ab9280&gt;]</span></span><br><span class="line"></span><br><span class="line">cashier = worker_list.xpath(<span class="string">&#x27;./cashier&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(cashier)  <span class="comment"># [&lt;Element cashier at 0x2432e913f00&gt;]</span></span><br><span class="line"></span><br><span class="line">cashier = worker_list.xpath(<span class="string">&#x27;cashier&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(cashier)  <span class="comment"># [&lt;Element cashier at 0x2432e913f00&gt;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># c.//路径  -  从任意位置开始全局搜索</span></span><br><span class="line"><span class="comment"># 查找方式和功能和xpath前的节点无关</span></span><br><span class="line"></span><br><span class="line">result = supermarket.xpath(<span class="string">&#x27;//cashier&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment"># [&lt;Element cashier at 0x10616ecc0&gt;. ]</span></span><br><span class="line">result = supermarket.xpath(<span class="string">&#x27;//goods&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment"># [&lt;Element goods at 0x2220e5c9380&gt;, &lt;Element goods at 0x2220e5c93c0&gt;, &lt;Element goods at 0x2220e5c9400&gt;]</span></span><br><span class="line">result = supermarket.xpath(<span class="string">&#x27;//goodslist/goods&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment"># [&lt;Element goods at 0x2220e5c9380&gt;, &lt;Element goods at 0x2220e5c93c0&gt;, &lt;Element goods at 0x2220e5c9400&gt;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4)获取节点内容</span></span><br><span class="line"><span class="comment"># 语法：获取节点的路径/text()</span></span><br><span class="line">name = supermarket.xpath(<span class="string">&#x27;./name/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(name)</span><br><span class="line"></span><br><span class="line">names = supermarket.xpath(<span class="string">&#x27;//name/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(names)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5)获取节点属性值</span></span><br><span class="line"><span class="comment"># 语法:获取节点的路径/@属性名</span></span><br><span class="line">cashier = supermarket.xpath(<span class="string">&#x27;//goods/@price&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(cashier)</span><br></pre></td></tr></table></figure>



<h1 id="2-xpath解析之html"><a href="#2-xpath解析之html" class="headerlink" title="2.xpath解析之html"></a>2.xpath解析之html</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.HTML(<span class="built_in">open</span>(<span class="string">&#x27;files/test.html&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>).read())</span><br><span class="line"></span><br><span class="line">h1 = html.xpath(<span class="string">&#x27;//h1/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(h1)</span><br><span class="line"></span><br><span class="line">h1 = html.xpath(<span class="string">&#x27;./body/h1/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(h1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.加谓语(加条件)</span></span><br><span class="line"><span class="comment"># 选中标签的路径[谓语]</span></span><br><span class="line"><span class="comment"># a.[N]  -  获取同级的相同标签的第N个</span></span><br><span class="line">p = html.xpath(<span class="string">&#x27;./body/p[1]/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line">result = html.xpath(<span class="string">&#x27;//li[1]/p/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2)</span></span><br><span class="line"><span class="comment"># [last()]  -  获取同层的最后一个标签</span></span><br><span class="line"><span class="comment"># [last()-N]  -  获取同层的倒数第(N+1)个</span></span><br><span class="line">result = html.xpath(<span class="string">&#x27;./body/ul/li[last()-1]/p[last()]/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3)</span></span><br><span class="line"><span class="comment"># [position()&gt;N]</span></span><br><span class="line"><span class="comment"># [position()&lt;N]</span></span><br><span class="line"><span class="comment"># [position()&gt;=N]</span></span><br><span class="line"><span class="comment"># [position()&lt;=N]</span></span><br><span class="line">result = html.xpath(<span class="string">&#x27;./body/ul/li[position()&lt;=2]/p/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4) [@属性名]  -  获取有指定属性的标签</span></span><br><span class="line"><span class="comment"># p[@class]  - 有class属性的p标签</span></span><br><span class="line">result = html.xpath(<span class="string">&#x27;./body/div/p[@class]/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># [@属性名=&#x27;值&#x27;]  -  获取有指定属性是指定值的标签</span></span><br><span class="line">result = html.xpath(<span class="string">&#x27;./body/div/p[@class=&quot;b&quot;]/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5)</span></span><br><span class="line"><span class="comment"># [标签 &gt;/&lt;/&gt;=/&lt;=/= 数据]  -   将标签按照指定子标签的内容进行筛选</span></span><br><span class="line"></span><br><span class="line">result = html.xpath(<span class="string">&#x27;./body/ul/li[p[2]&gt;4]/p/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">result = html.xpath(<span class="string">&#x27;./body/ul/li[p[3]&gt;30]/p[1]/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">result = html.xpath(<span class="string">&#x27;./body/ul/li[p[1] = &quot;面包&quot;]/p/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.通配符 ：*</span></span><br><span class="line"><span class="comment"># 1) 表示任意标签</span></span><br><span class="line">result = html.xpath(<span class="string">&#x27;./body/div[@id=&quot;div1&quot;]/*&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">result = html.xpath(<span class="string">&#x27;./body/div[@id=&quot;div1&quot;]/*[@class]&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">result = html.xpath(<span class="string">&#x27;//*[@class=&quot;c1&quot;]/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) 表示任意属性</span></span><br><span class="line">result = html.xpath(<span class="string">&#x27;./body/div[last()]/p[@*]/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 分支(获取若干路径)  - |</span></span><br><span class="line"><span class="comment"># 注意：一个竖线隔开的必须是两个独立的路径</span></span><br><span class="line">result = html.xpath(<span class="string">&#x27;./body/ul/li/p[1]/text()|./body/ul/li/p[2]/text()&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>



<h1 id="3-html测试数据"><a href="#3-html测试数据" class="headerlink" title="3.html测试数据"></a>3.html测试数据</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>商店<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>永辉超市<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>肖家河大厦<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>营业中<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;name&quot;</span>&gt;</span>泡面<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;price&quot;</span>&gt;</span>3.5<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>15<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;name&quot;</span>&gt;</span>矿泉水<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;price&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>120<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;name&quot;</span>&gt;</span>面包<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;price&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>42<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;name&quot;</span>&gt;</span>充电宝<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;price&quot;</span>&gt;</span>150<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>10<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;a&quot;</span>&gt;</span>p1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;b&quot;</span>&gt;</span>p2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;c1&quot;</span>&gt;</span>p3<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;d&quot;</span>&gt;</span>p4<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;c1&quot;</span>&gt;</span>p1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p2&quot;</span>&gt;</span>p2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>a1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;c1&quot;</span>&gt;</span>span1<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fbpic.588ku.com%2Felement_origin_min_pic%2F17%2F06%2F13%2F5c5a1442f0ec72e59829ee10d891f224.jpg%21r650&amp;refer=http%3A%2F%2Fbpic.588ku.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1631690803&amp;t=ddfb673477426b3255f364e59966b2f1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://lxmy.top/2021/09/13/stage2/2-2%20(5)/" data-id="ckthx4uot0012xcuc5dcz91c5" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-stage2/2-2 (4)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/13/stage2/2-2%20(4)/" class="article-date">
  <time class="dt-published" datetime="2021-09-13T00:36:53.717Z" itemprop="datePublished">2021-09-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1-前进后退和切换选项卡"><a href="#1-前进后退和切换选项卡" class="headerlink" title="1.前进后退和切换选项卡"></a>1.前进后退和切换选项卡</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">b = Chrome()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">b.get(&#x27;https://www.baidu.com&#x27;)</span></span><br><span class="line"><span class="string">time.sleep(1)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">b.get(&#x27;https://www.runoob.com&#x27;)</span></span><br><span class="line"><span class="string">time.sleep(1)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">b.get(&#x27;https://movie.douban.com/top250&#x27;)</span></span><br><span class="line"><span class="string">time.sleep(1)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">b.back()</span></span><br><span class="line"><span class="string">time.sleep(1)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">b.forward()</span></span><br><span class="line"><span class="string">time.sleep(5)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">b.close()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">b = Chrome()</span><br><span class="line">douban_url = <span class="string">&#x27;https://movie.douban.com/&#x27;</span></span><br><span class="line">b.get(douban_url)</span><br><span class="line">music = b.find_element_by_css_selector(<span class="string">&#x27;.global-nav-items&gt;ul&gt;li:nth-child(4)&gt;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">music_url = music.get_attribute(<span class="string">&#x27;href&#x27;</span>)</span><br><span class="line"></span><br><span class="line">music.click()</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># 切换选项卡</span></span><br><span class="line">b.switch_to.window(b.window_handles[<span class="number">0</span>])</span><br><span class="line">b.get(douban_url)  <span class="comment"># 切换完选项卡以后必须重新加载这个选项卡中的页面</span></span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">b.switch_to.window(b.window_handles[<span class="number">1</span>])</span><br><span class="line">b.get(music_url)</span><br><span class="line"></span><br><span class="line">b.close()</span><br></pre></td></tr></table></figure>



<h1 id="2-等待"><a href="#2-等待" class="headerlink" title="2.等待"></a>2.等待</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"></span><br><span class="line">b = Chrome()</span><br><span class="line">b.get(<span class="string">&#x27;https://read.douban.com/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;1.隐式等待 - 全局有效(只需要设置一次)</span></span><br><span class="line"><span class="string">如果设置了隐式等待时间,那么浏览器对象在通过find_element相关方法获取标签的时候</span></span><br><span class="line"><span class="string">在找不到对应的标签的时候不会马上报错,而是在指定时间内不断尝试获取该标签,</span></span><br><span class="line"><span class="string">如果超过了指定的时间还是获取不到才会报错</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">b.implicitly_wait(<span class="number">2</span>)   <span class="comment"># 隐式等待</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">2.显示等待</span></span><br><span class="line"><span class="string">1)创建等待对象WebDriverWait(浏览器对象,超时时间)</span></span><br><span class="line"><span class="string">2)</span></span><br><span class="line"><span class="string">等待对象.until(条件) - 等到指定条件为True获取对应标签</span></span><br><span class="line"><span class="string">等待对象.until_not(条件) - 等到指定条件为False获取对应标签</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">常见的条件：</span></span><br><span class="line"><span class="string">EC.presence_of_element_located((By.标签获取方式，获取方式值))：判断某个元素是否被加到dom树里(判断某个标签是否加载到网页中，不一定可见)</span></span><br><span class="line"><span class="string">EC.visibility_of_element_located:判断某个标签是否可见(没有隐藏，并且元素的宽度和高度都不等于0)</span></span><br><span class="line"><span class="string">EC.text_to_be_present_in_element:判断某个标签中的标签内容是否包含了预期的字符串</span></span><br><span class="line"><span class="string">EC.text_to_be_present_in_element_value:判断某个标签中的value属性是否包含了预期的字符串</span></span><br><span class="line"><span class="string">EC.element_to_be_clickable:判断某个标签是否可以点击</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">wait = WebDriverWait(b, <span class="number">5</span>)</span><br><span class="line">wait.until(EC.presence_of_element_located((By.ID, <span class="string">&#x27;p&#x27;</span>)))</span><br><span class="line">wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">&#x27;css选择器&#x27;</span>)))</span><br><span class="line"></span><br><span class="line">wait.until(EC.visibility_of_element_located((By.ID, <span class="string">&#x27;id属性值&#x27;</span>)))</span><br><span class="line">wait.until(EC.text_to_be_present_in_element((By.ID, <span class="string">&#x27;id属性值&#x27;</span>), <span class="string">&#x27;请登录&#x27;</span>))</span><br><span class="line">wait.until_not(EC.text_to_be_present_in_element((By.ID, <span class="string">&#x27;id属性值&#x27;</span>), <span class="string">&#x27;请登录&#x27;</span>))</span><br><span class="line"></span><br><span class="line">wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR, <span class="string">&#x27;css选择器&#x27;</span>)))</span><br></pre></td></tr></table></figure>



<h1 id="3-京东页面滚动"><a href="#3-京东页面滚动" class="headerlink" title="3.京东页面滚动"></a>3.京东页面滚动</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome, ChromeOptions</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">options = ChromeOptions()</span><br><span class="line">options.add_experimental_option(<span class="string">&quot;excludeSwitches&quot;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>, <span class="string">&#x27;enable-logging&#x27;</span>])</span><br><span class="line">options.add_experimental_option(<span class="string">&quot;prefs&quot;</span>, &#123;<span class="string">&quot;profile.managed_default_content_settings.images&quot;</span>: <span class="number">2</span>&#125;)</span><br><span class="line"></span><br><span class="line">b = Chrome(options=options)</span><br><span class="line">b.get(<span class="string">&#x27;https://www.jd.com&#x27;</span>)</span><br><span class="line">b.implicitly_wait(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">search_input = b.find_element_by_id(<span class="string">&#x27;key&#x27;</span>)</span><br><span class="line">search_input.send_keys(<span class="string">&#x27;电脑&#x27;</span>)</span><br><span class="line">search_input.send_keys(Keys.ENTER)</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># b.execute_script(&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#         max_height = 4000</span></span><br><span class="line"><span class="comment">#         height = 0</span></span><br><span class="line"><span class="comment">#         timmer = setInterval(function()&#123;</span></span><br><span class="line"><span class="comment">#             window.scrollTo(0, height)</span></span><br><span class="line"><span class="comment">#             height += 100</span></span><br><span class="line"><span class="comment">#             if (height &gt; max_height)&#123;</span></span><br><span class="line"><span class="comment">#                 clearInterval(timmer)</span></span><br><span class="line"><span class="comment">#             &#125;</span></span><br><span class="line"><span class="comment">#             console.log(height)</span></span><br><span class="line"><span class="comment">#             &#125;, 1000)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &quot;&quot;&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 滚动</span></span><br><span class="line">max_height = <span class="number">8900</span></span><br><span class="line">height = <span class="number">500</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    b.execute_script(<span class="string">f&#x27;window.scrollTo(0,<span class="subst">&#123;height&#125;</span>)&#x27;</span>)</span><br><span class="line">    height += <span class="number">500</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> height &gt; max_height:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment"># b.execute_script(&#x27;alert(&quot;To Bottom&quot;)&#x27;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="4-163邮箱"><a href="#4-163邮箱" class="headerlink" title="4.163邮箱"></a>4.163邮箱</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"></span><br><span class="line">b = Chrome()</span><br><span class="line"></span><br><span class="line">b.get(<span class="string">&#x27;https://mail.163.com/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(b.page_source)</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">前端在实现网页功能的时候可能出现网页中嵌套网页的现象，如果要在一个网页中嵌套另外一个网页</span></span><br><span class="line"><span class="string">必须使用iframe标签</span></span><br><span class="line"><span class="string">selenium爬取的时候，通过浏览器对象默认获取到的是最外层的html对应的网页，如果要获取嵌套</span></span><br><span class="line"><span class="string">页面中的内容，必须同switch_to来切换frame</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">iframe = b.find_element_by_css_selector(<span class="string">&#x27;.loginUrs&gt;iframe&#x27;</span>)</span><br><span class="line"><span class="comment"># iframe1 = b.find_element_by_css_selector(&#x27;#loginDiv&gt;iframe&#x27;)</span></span><br><span class="line"></span><br><span class="line">b.switch_to.frame(iframe)</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">input_account = b.find_element_by_css_selector(<span class="string">&#x27;.j-inputtext&#x27;</span>)</span><br><span class="line">input_account.send_keys(<span class="string">&#x27;123456789&#x27;</span>)</span><br><span class="line"></span><br><span class="line">input_pwd = b.find_element_by_css_selector(<span class="string">&#x27;.dlpwd&#x27;</span>)</span><br><span class="line">input_pwd.send_keys(<span class="string">&#x27;123456789&#x27;</span>)</span><br><span class="line"></span><br><span class="line">login_button = b.find_element_by_css_selector(<span class="string">&#x27;.u-loginbtn&#x27;</span>)</span><br><span class="line">login_button.send_keys(Keys.ENTER)</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://lxmy.top/2021/09/13/stage2/2-2%20(4)/" data-id="ckthx4uos0011xcuc925gdq5u" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-stage2/2-2 (3)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/13/stage2/2-2%20(3)/" class="article-date">
  <time class="dt-published" datetime="2021-09-13T00:36:53.714Z" itemprop="datePublished">2021-09-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1-requests-代理Ip的使用"><a href="#1-requests-代理Ip的使用" class="headerlink" title="1.requests 代理Ip的使用"></a>1.requests 代理Ip的使用</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.获取蘑菇代理中的代理Ip</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_ip</span>():</span></span><br><span class="line">    res = requests.get(<span class="string">&#x27;http://piping.mogumiao.com/proxy/api/get_ip_bs?appKey=775206edf3dc4329ba04568b75a66a30&amp;count=4&amp;expiryDate=0&amp;format=2&amp;newLine=3&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> res.text[<span class="number">0</span>] == <span class="string">&#x27;&#123;&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;提取Ip失败&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> [x <span class="keyword">for</span> x <span class="keyword">in</span> res.text.split(<span class="string">&#x27;\n&#x27;</span>) <span class="keyword">if</span> x]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用代理Ip</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_net_data</span>():</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ips = get_ip()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ips :</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ip获取失败&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    proxies = &#123;</span><br><span class="line">        <span class="string">&#x27;http&#x27;</span> : ips[<span class="number">0</span>],</span><br><span class="line">        <span class="string">&#x27;https&#x27;</span> : ips[<span class="number">1</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res = requests.get(<span class="string">&#x27;https://movie/douban.com/top250&#x27;</span>,headers=headers,proxies=proxies)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    get_net_data()</span><br></pre></td></tr></table></figure>



<h1 id="2-使用代理的优化程序"><a href="#2-使用代理的优化程序" class="headerlink" title="2.使用代理的优化程序"></a>2.使用代理的优化程序</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_ip</span>():</span></span><br><span class="line">    res = requests.get(<span class="string">&#x27;http://piping.mogumiao.com/proxy/api/get_ip_bs?appKey=775206edf3dc4329ba04568b75a66a30&amp;count=4&amp;expiryDate=0&amp;format=2&amp;newLine=3&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> res.text[<span class="number">0</span>] == <span class="string">&#x27;&#123;&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;提取Ip失败&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> [x <span class="keyword">for</span> x <span class="keyword">in</span> res.text.split(<span class="string">&#x27;\n&#x27;</span>) <span class="keyword">if</span> x]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_net_data</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        ips = get_ip()</span><br><span class="line">        <span class="keyword">if</span> ips:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ip获取成功&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    proxies = &#123;</span><br><span class="line">        <span class="string">&#x27;http&#x27;</span>: ips[<span class="number">1</span>],</span><br><span class="line">        <span class="string">&#x27;https&#x27;</span>: ips[<span class="number">2</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res = requests.get(<span class="string">&#x27;https://movie.douban.com/top250&#x27;</span>, headers=headers, proxies=proxies)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    get_net_data()</span><br></pre></td></tr></table></figure>



<h1 id="3-selenium的基本功能"><a href="#3-selenium的基本功能" class="headerlink" title="3.selenium的基本功能"></a>3.selenium的基本功能</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.创建浏览器对象(如果是全局变量,程序结束后浏览器不会关闭,局部变量会自动关闭)</span></span><br><span class="line">b = Chrome()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.输入网址</span></span><br><span class="line">b.get(<span class="string">&#x27;https://www.jd.com&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.获取网页源代码</span></span><br><span class="line"><span class="built_in">print</span>(b.page_source)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.关闭浏览器</span></span><br><span class="line">b.close()</span><br></pre></td></tr></table></figure>



<h1 id="4-selenium的简单交互"><a href="#4-selenium的简单交互" class="headerlink" title="4.selenium的简单交互"></a>4.selenium的简单交互</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.创建浏览器对象</span></span><br><span class="line">b = Chrome()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.打开网页</span></span><br><span class="line">b.get(<span class="string">&#x27;https://www.51job.com/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.获取标签(输入框)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># search_input = b.find_element_by_id(&#x27;kwdselectid&#x27;)</span></span><br><span class="line">search_input = b.find_element_by_css_selector(<span class="string">&#x27;#kwdselectid&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.在输入框中输入内容</span></span><br><span class="line">search_input.send_keys(<span class="string">&#x27;数据分析&#x27;</span>)</span><br><span class="line"><span class="comment"># 按输入框中回车键</span></span><br><span class="line">search_input.send_keys(Keys.ENTER)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.获取网页数据</span></span><br><span class="line"><span class="comment"># print(b.page_source)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.获取下一页对应标签</span></span><br><span class="line"><span class="built_in">next</span> = b.find_element_by_css_selector(<span class="string">&#x27;.next&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.点击按钮</span></span><br><span class="line"><span class="built_in">next</span>.click()</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(b.page_source)</span><br><span class="line"></span><br><span class="line">b.close()</span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome,ChromeOptions</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_ip</span>():</span></span><br><span class="line">    res = requests.get(<span class="string">&#x27;http://piping.mogumiao.com/proxy/api/get_ip_bs?appKey=775206edf3dc4329ba04568b75a66a30&amp;count=4&amp;expiryDate=0&amp;format=2&amp;newLine=3&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> res.text[<span class="number">0</span>] == <span class="string">&#x27;&#123;&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;提取Ip失败&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> [x <span class="keyword">for</span> x <span class="keyword">in</span> res.text.split(<span class="string">&#x27;\n&#x27;</span>) <span class="keyword">if</span> x]</span><br><span class="line"></span><br><span class="line">ips = get_ip()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    ips = get_ip()</span><br><span class="line">    <span class="keyword">if</span> ips:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;ip获取成功&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.创建谷歌浏览器的配置对象</span></span><br><span class="line">options  = ChromeOptions()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1)添加取消测试环境选项</span></span><br><span class="line">options.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>,[<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2)取消图片加载</span></span><br><span class="line">options.add_experimental_option(<span class="string">&quot;prefs&quot;</span>, &#123;<span class="string">&quot;profile.managed_default_content_settings.images&quot;</span>: <span class="number">2</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3)设置代理</span></span><br><span class="line">options.add_argument(<span class="string">f&#x27;--proxy-server=http://<span class="subst">&#123;ips[<span class="number">2</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">b = Chrome(options=options)</span><br><span class="line"></span><br><span class="line">b.get(<span class="string">&#x27;https://movie.douban.com/top250&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(b.page_source)</span><br></pre></td></tr></table></figure>



<h1 id="5-爬取前程无忧网数据分析岗位"><a href="#5-爬取前程无忧网数据分析岗位" class="headerlink" title="5.爬取前程无忧网数据分析岗位"></a>5.爬取前程无忧网数据分析岗位</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.创建浏览器对象</span></span><br><span class="line">b = Chrome()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.打开网页</span></span><br><span class="line">b.get(<span class="string">&#x27;https://www.51job.com/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.获取标签(输入框)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># search_input = b.find_element_by_id(&#x27;kwdselectid&#x27;)</span></span><br><span class="line">search_input = b.find_element_by_css_selector(<span class="string">&#x27;#kwdselectid&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.在输入框中输入内容</span></span><br><span class="line">search_input.send_keys(<span class="string">&#x27;数据分析&#x27;</span>)</span><br><span class="line"><span class="comment"># 按输入框中回车键进入数据分析岗位页面</span></span><br><span class="line">search_input.send_keys(Keys.ENTER)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.获取网页数据</span></span><br><span class="line"><span class="comment"># print(b.page_source)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">all_job = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    soup = BeautifulSoup(b.page_source,<span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">    <span class="comment"># print(soup)</span></span><br><span class="line"></span><br><span class="line">    all_job_div = soup.select(<span class="string">&#x27;.e&#x27;</span>)</span><br><span class="line">    <span class="comment"># print(all_job_div)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> div <span class="keyword">in</span> all_job_div:</span><br><span class="line">        <span class="keyword">if</span> div.select_one(<span class="string">&#x27;.jname&#x27;</span>):</span><br><span class="line">            job_name = div.select_one(<span class="string">&#x27;.jname&#x27;</span>).get_text()</span><br><span class="line">            job_wages = div.select_one(<span class="string">&#x27;.sal&#x27;</span>).get_text()</span><br><span class="line">            job_demand = div.select_one(<span class="string">&#x27;.d&#x27;</span>).get_text()</span><br><span class="line">            company = div.select_one(<span class="string">&#x27;.cname&#x27;</span>).get_text()</span><br><span class="line">            company_url = div.select_one(<span class="string">&#x27;.er &gt; a&#x27;</span>).attrs[<span class="string">&#x27;href&#x27;</span>]</span><br><span class="line">            all_job.append([job_name,job_wages,job_demand,company,company_url])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6.获取下一页对应标签</span></span><br><span class="line">    <span class="built_in">next</span> = b.find_element_by_css_selector(<span class="string">&#x27;.next&#x27;</span>)</span><br><span class="line">    <span class="comment"># 7.点击按钮进入下一页</span></span><br><span class="line">    <span class="built_in">next</span>.click()</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">b.quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;files/qianchen.csv&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">writer = csv.writer(f)</span><br><span class="line">writer.writerows(all_job)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://lxmy.top/2021/09/13/stage2/2-2%20(3)/" data-id="ckthx4uoo0010xcuce558atak" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-stage2/2-2 (2)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/13/stage2/2-2%20(2)/" class="article-date">
  <time class="dt-published" datetime="2021-09-13T00:36:53.710Z" itemprop="datePublished">2021-09-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="requests的使用方法"><a href="#requests的使用方法" class="headerlink" title="requests的使用方法"></a>requests的使用方法</h1><h2 id="requests：python基于http协议进行网络请求的第三方库"><a href="#requests：python基于http协议进行网络请求的第三方库" class="headerlink" title="requests：python基于http协议进行网络请求的第三方库"></a>requests：python基于http协议进行网络请求的第三方库</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1.发送请求</span></span><br><span class="line"><span class="string">requests.get(URL,*,headers, params, proxies)  -  发送get请求</span></span><br><span class="line"><span class="string">requests.post(URL,*,headers, params, proxies) -  发送post请求</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">参数:</span></span><br><span class="line"><span class="string">url  -  请求地址(一个网站的网址、接口的地址、图片地址等)</span></span><br><span class="line"><span class="string">headers  -  设置请求头(设置cookie和User-Agent的时候使用)</span></span><br><span class="line"><span class="string">params  -  设置参数</span></span><br><span class="line"><span class="string">proxies -  设置代理</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送get请求，参数直接拼接到url中</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># requests.get(&#x27;http://api.tianapi.com/auto/index?key=c9d408fefd8ed4081a9079d0d6165d43&amp;num=10&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送post请求，参数设置在params中</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">params = &#123;</span></span><br><span class="line"><span class="string">    &#x27;key&#x27;: &#x27;c9d408fefd8ed4081a&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;num&#x27;: 10</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">requests.post(&#x27;http://api.tianapi.com/auto/index&#x27;, params=params)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">import requests</span></span><br><span class="line"><span class="string">res = requests.get(&#x27;http://www.yingjiesheng.com/&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;2.获取响应信息&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 设置编码方式(乱码的时候才设置)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">res.encoding = &#x27;gbk&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 获取响应头信息</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># print(res.headers)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 获取响应体</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># a.获取text值(用于请求网页,直接拿到网页源代码)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># print(res.text)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#b.获取json解析结果(用于返回json数据的数据接口)</span></span><br><span class="line"><span class="string">#print(res.json())</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#c.获取content值(获取二进制类型的原数据,用于图片,视频,音频的下载)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># print(res.content)</span></span><br></pre></td></tr></table></figure>




<h1 id="添加请求头"><a href="#添加请求头" class="headerlink" title="添加请求头"></a>添加请求头</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------1. 添加User-Agent-------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># headers = &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#     &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># response = requests.get(&#x27;https://www.51job.com/&#x27;, headers=headers)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># response.encoding = &#x27;gbk&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(response.text)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------2. 添加cookie--------------------------</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;cookie&#x27;</span>: <span class="string">&#x27;_zap=4d58cb38-ec48-47b2-9e47-8ff8ef963486; _xsrf=veOhJnW2hAC2BDcgK8KTU4NqUrLUYuTe; d_c0=&quot;AHAQrl0PjROPTn2Bv2wpyQXt8QUwjW6yjTU=|1628663892&quot;; Hm_lvt_98beee57fd2ef70ccdd5ca52b9740c49=1628663893; __snaker__id=EYMWPXdZknPXfAye; gdxidpyhxdE=QQQ9DNLdBqx13etuowzGeLbMfcPXBfHckpwZ%2BxZp06A8zi9JHMPDxcbRi4o%5Ca053y5oVnjBBBb99XeqPZicZtcN2%5CR7snyRY8LQP%2Ff1Lu%5CEaPuZo9DldazSjxxzCmy0GXU7zlEHvH5jbqRxsq3d4HX5PN3j%5Cw7yrH2Ls29BYDaDCm0%2Fb%3A1628664795621; _9755xjdesxxd_=32; YD00517437729195%3AWM_NI=xDnvQnHhpYF6yUCebu826Rf%2FtJfpY7qOemzjWKJqvTeiC%2FN7ac2Cye8KddfyGIjjNxMaj1gnnUNWT6pGUEzV16y8CNLWmizD0SakKVmh9ELwcWrCleatFrWHNaWfd%2F1ZdWM%3D; YD00517437729195%3AWM_NIKE=9ca17ae2e6ffcda170e2e6eed4b479ad9e898bbc2591868bb3d85e968a9aaab566acb08196e862bbb4b7ade52af0fea7c3b92abc9ca297d4668cb8c0bac53ebb8b8d86e17ffceefab3e525b896aa91dc3db391ab8ef96295958692f560a7b78dd0cd3da3bdfea4fc6ffc95ac85e5738597a68bcd748fbfa6d2e666ae8b82b8d73eb4999ba6f95ef3eab7d9c2469089a38af950f48daf8cca5eafb8f7a6cf7da189bea4ef6fa3ac8a93d6448ebf9987e725f386acb8d037e2a3; YD00517437729195%3AWM_TID=Lftr4M6kyApFUEUBFFcv0DqgQ5uBSC%2FF; captcha_session_v2=&quot;2|1:0|10:1628663907|18:captcha_session_v2|88:OCtMcVVod1VSRDZ4Q2tTbGNyNUVIUXdJREc5Y0lSbjJyMklwSWh5MTA0NVhpL3JLak1CZXBPMEQ1ZlcycGludQ==|7f6c9d93866de2c49808fd0c3fa7ec6f7ef407e0fa6678072b00b577b351fb5f&quot;; captcha_ticket_v2=&quot;2|1:0|10:1628663918|17:captcha_ticket_v2|704:eyJ2YWxpZGF0ZSI6IkNOMzFfWVZ5NHQwWm1wZlJWN1pSQzd6czQ0dUF6cG51Q2xFbHk2d0h0RjdYSWt4RDQ3ODJuOXMta2ROclliYkt6SFNGWUNvc2NCLklvdll0ejVZSmM5T0lOR1lwa2gxTTQwRWlVOWtmdmZqN3U3Q2g2Y2ZQU1c2VjJ3UDJvV0ZWa2hpLTJWUlF6ZDdmTWItMnRDV1dfOHM2ZkNpcFRsYlhOdUZaOXpVVDlCMXhGRy0xTkdoUnJrWlpkUERmelNiVzZMMk83WVVkSkVUSjJzZ1F1WEtnODBIaGV0NlNjcVpUdUt4ZUhSUFNyS1lOUGRfeTl5dEI5TUduS2xFUVpRYzB6REs3d0dzTWpKbW1FUzBiSlBDdUo1WURxd1F0cVdFLTFOX01TQUJOSjdraEYxbDZzSUxRcVVaZmE1NDR5OXRKVXBwa014TkQ2N3lDR0xxNG4yWENUaGhlLUlsMEEyTHFuV3RPa1ppSy1STENCWVVRdkZKaDVYMWR4YVhaeWl5QnpRZ2FrUE5UelNRVmg3RzJVeUJmU1VGVGRyMHpFODktWTcuRENMNzA5cVEuRnZTN0NfWk9XN0swOW9vaUs1anJMcC1SbHotWGRPdE9wTnZpbGJXY3U5dU0uSjFhNTFrODYxREJpZjhJQXJ4X21XMnotTmZMd0RkTzZHSEFpdkJhMyJ9|66c432f2881af153cce75b5940defd6b832a569f89e6b9eaebfd514b1d4ea329&quot;; z_c0=&quot;2|1:0|10:1628663938|4:z_c0|92:Mi4xaW5CWUdRQUFBQUFBY0JDdVhRLU5FeVlBQUFCZ0FsVk5ncjRBWWdBZkNmZWVoMkphV0tZWDdSOUl6MVo1VFdPOXJB|58971e1efcbfec5e768e019f0c12ec85652bb22b2917e2cff02d68947b812353&quot;; unlock_ticket=&quot;ADAc3rNA2xAmAAAAYAJVTYp3E2GJixRcAVFMYYkPJW256QCAFDClgw==&quot;; tst=r; Hm_lpvt_98beee57fd2ef70ccdd5ca52b9740c49=1628664181; SESSIONID=ALeO6SNDSqNPVjPc3Ao25v7TXs18vru2Tvmqpwqdoal; KLBRSID=dc02df4a8178e8c4dfd0a3c8cbd8c726|1628664185|1628663890; JOID=UVARB04wYKVlY693JDctP1npsqUxeiDAK1P3NWBlGuc1NMMsS04dtwNuqHslc7UnVsGLPcQ2PuJWOI7F7kuQiRE=; osd=W1gVC086aKFpYqV_IDssNVHtvqQ7ciTMKln_MWxkEO8xOMImQ0oRtglmrHckeb0jWsCBNcA6P-hePILE5EOUhRA=&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">&#x27;https://www.zhihu.com/&#x27;</span>, headers=headers)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h1 id="获取今日头条的json数据接口，然后在发送请求"><a href="#获取今日头条的json数据接口，然后在发送请求" class="headerlink" title="获取今日头条的json数据接口，然后在发送请求"></a>获取今日头条的json数据接口，然后在发送请求</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># 获取今日头条的json数据接口，然后在发送请求</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://www.toutiao.com/hot-event/hot-board/?origin=toutiao_pc&amp;_signature=_02B4Z6wo00d01X.g2AgAAIDDl0iJmFbkIVl.xNyAAD7ve5rc90eYpUagYiMEKQrfIz8iJPKuacCxb32tQcqbwZpt0i3u2X-hae-fgV3NqtDiEbEJK7EPc235gzTPL4EhVZ7cxFeHkLUI27pv29&quot;</span></span><br><span class="line">res = requests.get(url)</span><br><span class="line"><span class="built_in">print</span>(res.json())</span><br></pre></td></tr></table></figure>







<h1 id="图片下载"><a href="#图片下载" class="headerlink" title="图片下载"></a>图片下载</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_image</span>(<span class="params">img_url</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 请求网络图片数据</span></span><br><span class="line"></span><br><span class="line">​    res = requests.get(img_url)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取数据保存到本地文件</span></span><br><span class="line">    </span><br><span class="line">    data = res.content</span><br><span class="line">    </span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">f&#x27;files/<span class="subst">&#123;img_url.split(<span class="string">&quot;/&quot;</span>)[-<span class="number">1</span>]&#125;</span>&#x27;</span>,<span class="string">&quot;wb&quot;</span>)</span><br><span class="line">    f.write(data)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">   download_image(<span class="string">&#x27;https://p5.toutiaoimg.com/img/pgc-image/9f5d102756354b6db8fa9408c57d01c8~cs_noop.png&#x27;</span>)</span><br></pre></td></tr></table></figure>





<h1 id="千图网"><a href="#千图网" class="headerlink" title="千图网"></a>千图网</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> findall</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_image</span>(<span class="params">img_url</span>):</span></span><br><span class="line">    <span class="comment"># 请求网络图片数据</span></span><br><span class="line">    response = requests.get(img_url)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取数据保存到本地文件</span></span><br><span class="line">    data = response.content</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&#x27;files/千图网/<span class="subst">&#123;img_url.split(<span class="string">&quot;/&quot;</span>)[-<span class="number">1</span>].split(<span class="string">&quot;!&quot;</span>)[<span class="number">0</span>]&#125;</span>&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        fp.write(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    response = requests.get(<span class="string">&#x27;https://www.58pic.com/tupian/qixi-0-0.html&#x27;</span>)</span><br><span class="line">    data = response.text</span><br><span class="line">    result = findall(<span class="string">r&#x27;(?s)&lt;img src=&quot;(\S+?)&quot;&gt;&#x27;</span>, data)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> result:</span><br><span class="line">        download_image(<span class="string">f&#x27;https:<span class="subst">&#123;x&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;下载成功&#x27;</span>)</span><br></pre></td></tr></table></figure>







<h1 id="bs4的使用"><a href="#bs4的使用" class="headerlink" title="bs4的使用"></a>bs4的使用</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 准备需要解析的网页数据(实际是用request或者selenium获取)</span></span><br><span class="line"></span><br><span class="line">data = <span class="built_in">open</span>(<span class="string">&#x27;test2.html&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. BeautifulSoup对象(可以自动纠正数据中错误的html结构)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># BeautifulSoup(数据，解析器)</span></span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(data, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 通过BeautifulSp对象获取标签和标签内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1) 获取标签</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># BeautifulSoup对象.select(css选择器)  -  获取css选择器选中的所有标签 返回的是列表,列表元素是选中的标签对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># BeautifulSoup对象.select_one(css选择器)  -  获取css选择器选中的第一个标签,返回的是标签对象</span></span><br><span class="line"></span><br><span class="line">result = soup.select(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)           <span class="comment"># [&lt;p&gt;我是段落1&lt;/p&gt;, &lt;p&gt;我是段落2&lt;/p&gt;, &lt;p&gt;我是超链接3&lt;/p&gt;]</span></span><br><span class="line"></span><br><span class="line">result = soup.select_one(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)           <span class="comment"># &lt;p&gt;我是段落1&lt;/p&gt;</span></span><br><span class="line"></span><br><span class="line">result = soup.select(<span class="string">&#x27;#p1&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)           <span class="comment"># [&lt;p id=&quot;p1&quot;&gt;我是超链接3&lt;/p&gt;]</span></span><br><span class="line"></span><br><span class="line">result = soup.select_one(<span class="string">&#x27;#p1&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)       <span class="comment"># &lt;p id=&quot;p1&quot;&gt;我是超链接3&lt;/p</span></span><br><span class="line"></span><br><span class="line">result = soup.select(<span class="string">&#x27;div p&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)       <span class="comment"># [&lt;p&gt;我是段落2&lt;/p&gt;, &lt;p id=&quot;p1&quot;&gt;我是超链接3&lt;/p&gt;]</span></span><br><span class="line"></span><br><span class="line">result = soup.select(<span class="string">&#x27;div&gt;p&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)       <span class="comment"># [&lt;p&gt;我是段落2&lt;/p&gt;]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) 获取标签内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a.标签对象.string       -       获取标签中的文字内容（只有在标签内容是纯文字的时候有效，否则结果是None）</span></span><br><span class="line"></span><br><span class="line">p2 = soup.select_one(<span class="string">&#x27;div&gt;p&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(p2)       <span class="comment"># &lt;p&gt;我是段落2&lt;/p&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p2.string)        <span class="comment"># &#x27;我是段落2&#x27;</span></span><br><span class="line"></span><br><span class="line">s1 = soup.select_one(<span class="string">&#x27;#s1&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(s1)       <span class="comment"># &lt;span id=&quot;s1&quot;&gt;我是&lt;b&gt;span1&lt;/b&gt;&lt;/span&gt;</span></span><br><span class="line"><span class="built_in">print</span>(s1.string)    <span class="comment"># None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># b.标签对象.get_text()   -   获取标签内容中所有的文字信息</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p2.get_text())        <span class="comment"># &#x27;我是段落2&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(s1.get_text())        <span class="comment"># &#x27;我是span1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># c. 标签对象.contents</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p2.contents)      <span class="comment"># [&#x27;我是段落2&#x27;]</span></span><br><span class="line">result = s1.contents</span><br><span class="line"><span class="built_in">print</span>(result)      <span class="comment"># [&#x27;我是&#x27;, &lt;b&gt;span1&lt;/b&gt;]</span></span><br><span class="line"><span class="built_in">print</span>(result[-<span class="number">1</span>].get_text())    <span class="comment"># &#x27;span1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3) 获取标签属性</span></span><br><span class="line"></span><br><span class="line">a1 = soup.select_one(<span class="string">&#x27;div&gt;a&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(a1)       <span class="comment"># &lt;a href=&quot;https://www.baidu.com&quot;&gt;我是超链接2&lt;/a&gt;</span></span><br><span class="line"><span class="built_in">print</span>(a1.attrs[<span class="string">&#x27;href&#x27;</span>])     <span class="comment"># &#x27;https://www.baidu.com&#x27;</span></span><br><span class="line"></span><br><span class="line">img1 = soup.select_one(<span class="string">&#x27;img&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(img1)     <span class="comment"># &lt;img alt=&quot;&quot; src=&quot;http://www.gaoimg.com/uploads/allimg/210801/1-210P1151401S1.jpg&quot;/&gt;</span></span><br><span class="line"><span class="built_in">print</span>(img1.attrs[<span class="string">&#x27;src&#x27;</span>])        <span class="comment"># &#x27;http://www.gaoimg.com/uploads/allimg/210801/1-210P1151401S1.jpg&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 补充：</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># BeautifulSoup对象.select/select_one(css选择器)   -  在整个网页中获取css选择器选中的标签</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 标签对象.select/select_one(css选择器)    -   在指定标签中获取css选择器选中的标签</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ps = soup.select(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(ps)       <span class="comment"># [&lt;p&gt;我是段落1&lt;/p&gt;, &lt;p&gt;我是段落2&lt;/p&gt;, &lt;p id=&quot;p1&quot;&gt;我是超链接3&lt;/p&gt;]</span></span><br><span class="line"></span><br><span class="line">div1 = soup.select_one(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">ps = div1.select(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(ps)       <span class="comment"># [&lt;p&gt;我是段落2&lt;/p&gt;, &lt;p id=&quot;p1&quot;&gt;我是超链接3&lt;/p&gt;]</span></span><br></pre></td></tr></table></figure>








      
    </div>
    <footer class="article-footer">
      <a data-url="http://lxmy.top/2021/09/13/stage2/2-2%20(2)/" data-id="ckthx4uon000zxcuc3koyaimj" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-stage2/2-2 (14)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/13/stage2/2-2%20(14)/" class="article-date">
  <time class="dt-published" datetime="2021-09-13T00:36:53.707Z" itemprop="datePublished">2021-09-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> HTTP - 超文本传输协议 - 请求响应式协议</span><br><span class="line"></span><br><span class="line">    HTTP 请求</span><br><span class="line">        ~ 请求行：GET /index.html HTTP/<span class="number">1.1</span></span><br><span class="line">        ~ 请求头：键值对</span><br><span class="line">        ~ 空行：\r\n</span><br><span class="line">        ~ 消息体：发给服务器的数据</span><br><span class="line"></span><br><span class="line">    HTTP 响应</span><br><span class="line">        ~ 响应行：HTTP/<span class="number">1.1</span> <span class="number">403</span> Forbidden</span><br><span class="line">        ~ 响应头：键值对</span><br><span class="line">            - Content-<span class="type">Type</span> ---&gt; MIME类型</span><br><span class="line">                ~ image/png</span><br><span class="line">                ~ text/html</span><br><span class="line">                ~ application/json</span><br><span class="line">                ~ application/pdf</span><br><span class="line">                ~ audio/mp3</span><br><span class="line">                ~ video/mp4</span><br><span class="line">                ~ application/vnd.ms-excel</span><br><span class="line">            - Content-Disposition ---&gt; 内容处置的方式</span><br><span class="line">                ~ inline</span><br><span class="line">                ~ attachment; filename=<span class="string">&quot;...&quot;</span> </span><br><span class="line">        ~ 空行：</span><br><span class="line">        ~ 消息体：HTML页面、JSON数据、图片、音视频、PDF、Excel、……</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> Ajax - Asynchronous JavaScript <span class="keyword">and</span> XML</span><br><span class="line">    ~ 异步请求：在浏览器后台偷偷给服务器发请求（不中断用户体验）</span><br><span class="line">        - XMLHttpRequest</span><br><span class="line">        - Fetch API</span><br><span class="line">        - Axois</span><br><span class="line">    ~ 局部刷新：不刷新整个页面，只刷新数据发生了变化的局部</span><br><span class="line">        - JavaScript ---&gt; DOM</span><br><span class="line"></span><br><span class="line">    HTML code = Tag + CSS + JavaScript</span><br><span class="line">        - Tag ---&gt; content</span><br><span class="line">        - CSS ---&gt; display</span><br><span class="line">        - JavaScript ---&gt; behavior</span><br><span class="line">            ~ ECMAScript ---&gt; 语法规范</span><br><span class="line">            ~ BOM ---&gt; 浏览器对象模型 ---&gt; window</span><br><span class="line">            ~ DOM ---&gt; 文档对象模型 ---&gt; document</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            messages: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">from</span>: <span class="string">&quot;余婷&quot;</span>,</span><br><span class="line">                    to: <span class="string">&quot;骆昊&quot;</span>,</span><br><span class="line">                    content: <span class="string">&quot;晚上请你吃饭&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">from</span>: <span class="string">&quot;余婷&quot;</span>,</span><br><span class="line">                    to: <span class="string">&quot;骆昊&quot;</span>,</span><br><span class="line">                    content: <span class="string">&quot;发错了，抱歉&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">        &lt;messages&gt;</span><br><span class="line">            &lt;message&gt;</span><br><span class="line">                &lt;<span class="keyword">from</span>&gt;aa&lt;/<span class="keyword">from</span>&gt;</span><br><span class="line">                &lt;to&gt;bb&lt;/to&gt;</span><br><span class="line">                &lt;content&gt;晚上请你吃晚饭&lt;/content&gt;</span><br><span class="line">            &lt;/message&gt;</span><br><span class="line"></span><br><span class="line">            &lt;message&gt;</span><br><span class="line">                &lt;<span class="keyword">from</span>&gt;aa&lt;/<span class="keyword">from</span>&gt;</span><br><span class="line">                &lt;to&gt;bb&lt;/to&gt;</span><br><span class="line">                &lt;content&gt;发错了，抱歉&lt;/content&gt;</span><br><span class="line">            &lt;/message&gt;</span><br><span class="line">        &lt;/messages&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 渲染页面（把动态的内容填到页面上）的方式</span><br><span class="line">    ~ 后端渲染（服务器侧渲染）</span><br><span class="line">        缺点：</span><br><span class="line">        <span class="number">1.</span> 如果服务器的并发请求量很大，服务器会不堪重负</span><br><span class="line">        <span class="number">2.</span> 前端代码和后端代码混在了一起，没有完全分开</span><br><span class="line"></span><br><span class="line">    ~ 前端渲染（用户侧渲染）---&gt; 前后端分离的开发</span><br><span class="line">        要点：</span><br><span class="line">        <span class="number">1.</span> 服务器不负责渲染页面，只负责提供页面需要的数据（JSON）</span><br><span class="line">        <span class="number">2.</span> 浏览器通过JavaScript代码实现对页面的渲染 ---&gt; Vue</span><br><span class="line">        优点：</span><br><span class="line">        <span class="number">1.</span> 服务器负担减小，渲染页面的操作在用户端来完成</span><br><span class="line">        <span class="number">2.</span> 前端和后端代码完全分离，相互不牵扯，更有利于团队开发</span><br><span class="line">        缺点：</span><br><span class="line">        <span class="number">1.</span> 对于移动终端来说，耗电量会增加</span><br><span class="line">        <span class="number">2.</span> 如果用户终端性能不理想，那么用户体验可能会比较糟糕</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> 跨域问题</span><br><span class="line">    浏览器的同源策略会阻止JavaScript代码回访其他网站的数据，</span><br><span class="line">    如果希望别的网站能够跨域请求到我们提供的JSON数据接口，就必须进行跨域设置。</span><br><span class="line"></span><br><span class="line">    - 安装三方库：pip install flask-cors</span><br><span class="line">    - flask-cors三方库通过修改HTTP响应头，告诉浏览器可以允许跨域访问数据</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">from</span> flask_cors <span class="keyword">import</span> CORS</span><br><span class="line"></span><br><span class="line">    app = flask.Flask(__name__)</span><br><span class="line">    CORS(app)</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://lxmy.top/2021/09/13/stage2/2-2%20(14)/" data-id="ckthx4uon000yxcuc9cihgujt" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-stage2/2-2 (13)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/13/stage2/2-2%20(13)/" class="article-date">
  <time class="dt-published" datetime="2021-09-13T00:36:53.703Z" itemprop="datePublished">2021-09-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="python连接数据库插入数据"><a href="#python连接数据库插入数据" class="headerlink" title="python连接数据库插入数据"></a>python连接数据库插入数据</h1><h2 id="在数据库创建表并插入测试数据"><a href="#在数据库创建表并插入测试数据" class="headerlink" title="在数据库创建表并插入测试数据"></a>在数据库创建表并插入测试数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">drop database <span class="keyword">if</span> exists hrs;</span><br><span class="line">create database hrs default charset utf8mb4;</span><br><span class="line"></span><br><span class="line">use hrs;</span><br><span class="line"></span><br><span class="line">create table tb_dept</span><br><span class="line">(</span><br><span class="line">dno <span class="built_in">int</span> <span class="keyword">not</span> null comment <span class="string">&#x27;编号&#x27;</span>,</span><br><span class="line">dname varchar(<span class="number">10</span>) <span class="keyword">not</span> null comment <span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">dloc varchar(<span class="number">20</span>) <span class="keyword">not</span> null comment <span class="string">&#x27;所在地&#x27;</span>,</span><br><span class="line">primary key (dno)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into tb_dept values </span><br><span class="line">    (<span class="number">10</span>, <span class="string">&#x27;会计部&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">    (<span class="number">20</span>, <span class="string">&#x27;研发部&#x27;</span>, <span class="string">&#x27;成都&#x27;</span>),</span><br><span class="line">    (<span class="number">30</span>, <span class="string">&#x27;销售部&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>),</span><br><span class="line">    (<span class="number">40</span>, <span class="string">&#x27;运维部&#x27;</span>, <span class="string">&#x27;深圳&#x27;</span>);</span><br><span class="line"></span><br><span class="line">create table tb_emp</span><br><span class="line">(</span><br><span class="line">eno <span class="built_in">int</span> <span class="keyword">not</span> null comment <span class="string">&#x27;员工编号&#x27;</span>,</span><br><span class="line">ename varchar(<span class="number">20</span>) <span class="keyword">not</span> null comment <span class="string">&#x27;员工姓名&#x27;</span>,</span><br><span class="line">job varchar(<span class="number">20</span>) <span class="keyword">not</span> null comment <span class="string">&#x27;员工职位&#x27;</span>,</span><br><span class="line">mgr <span class="built_in">int</span> comment <span class="string">&#x27;主管编号&#x27;</span>,</span><br><span class="line">sal <span class="built_in">int</span> <span class="keyword">not</span> null comment <span class="string">&#x27;员工月薪&#x27;</span>,</span><br><span class="line">comm <span class="built_in">int</span> comment <span class="string">&#x27;每月补贴&#x27;</span>,</span><br><span class="line">dno <span class="built_in">int</span> comment <span class="string">&#x27;所在部门编号&#x27;</span>,</span><br><span class="line">primary key (eno)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- alter table tb_emp add constraint pk_emp_eno primary key (eno);</span><br><span class="line">-- alter table tb_emp add constraint uk_emp_ename unique (ename);</span><br><span class="line">-- alter table tb_emp add constraint fk_emp_mgr foreign key (mgr) references tb_emp (eno);</span><br><span class="line">-- alter table tb_emp add constraint fk_emp_dno foreign key (dno) references tb_dept (dno);</span><br><span class="line"></span><br><span class="line">insert into tb_emp values </span><br><span class="line">    (<span class="number">7800</span>, <span class="string">&#x27;张三丰&#x27;</span>, <span class="string">&#x27;总裁&#x27;</span>, null, <span class="number">9000</span>, <span class="number">1200</span>, <span class="number">20</span>),</span><br><span class="line">    (<span class="number">2056</span>, <span class="string">&#x27;乔峰&#x27;</span>, <span class="string">&#x27;分析师&#x27;</span>, <span class="number">7800</span>, <span class="number">5000</span>, <span class="number">1500</span>, <span class="number">20</span>),</span><br><span class="line">    (<span class="number">3088</span>, <span class="string">&#x27;李莫愁&#x27;</span>, <span class="string">&#x27;设计师&#x27;</span>, <span class="number">2056</span>, <span class="number">3500</span>, <span class="number">800</span>, <span class="number">20</span>),</span><br><span class="line">    (<span class="number">3211</span>, <span class="string">&#x27;张无忌&#x27;</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2056</span>, <span class="number">3200</span>, null, <span class="number">20</span>),</span><br><span class="line">    (<span class="number">3233</span>, <span class="string">&#x27;丘处机&#x27;</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2056</span>, <span class="number">3400</span>, null, <span class="number">20</span>),</span><br><span class="line">    (<span class="number">3251</span>, <span class="string">&#x27;张翠山&#x27;</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2056</span>, <span class="number">4000</span>, null, <span class="number">20</span>),</span><br><span class="line">    (<span class="number">5566</span>, <span class="string">&#x27;宋远桥&#x27;</span>, <span class="string">&#x27;会计师&#x27;</span>, <span class="number">7800</span>, <span class="number">4000</span>, <span class="number">1000</span>, <span class="number">10</span>),</span><br><span class="line">    (<span class="number">5234</span>, <span class="string">&#x27;郭靖&#x27;</span>, <span class="string">&#x27;出纳&#x27;</span>, <span class="number">5566</span>, <span class="number">2000</span>, null, <span class="number">10</span>),</span><br><span class="line">    (<span class="number">3344</span>, <span class="string">&#x27;黄蓉&#x27;</span>, <span class="string">&#x27;销售主管&#x27;</span>, <span class="number">7800</span>, <span class="number">3000</span>, <span class="number">800</span>, <span class="number">30</span>),</span><br><span class="line">    (<span class="number">1359</span>, <span class="string">&#x27;胡一刀&#x27;</span>, <span class="string">&#x27;销售员&#x27;</span>, <span class="number">3344</span>, <span class="number">1800</span>, <span class="number">200</span>, <span class="number">30</span>),</span><br><span class="line">    (<span class="number">4466</span>, <span class="string">&#x27;苗人凤&#x27;</span>, <span class="string">&#x27;销售员&#x27;</span>, <span class="number">3344</span>, <span class="number">2500</span>, null, <span class="number">30</span>),</span><br><span class="line">    (<span class="number">3244</span>, <span class="string">&#x27;欧阳锋&#x27;</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">3088</span>, <span class="number">3200</span>, null, <span class="number">20</span>),</span><br><span class="line">    (<span class="number">3577</span>, <span class="string">&#x27;杨过&#x27;</span>, <span class="string">&#x27;会计&#x27;</span>, <span class="number">5566</span>, <span class="number">2200</span>, null, <span class="number">10</span>),</span><br><span class="line">    (<span class="number">3588</span>, <span class="string">&#x27;朱九真&#x27;</span>, <span class="string">&#x27;会计&#x27;</span>, <span class="number">5566</span>, <span class="number">2500</span>, null, <span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">-- mysql中的简单查询语句</span><br><span class="line">use hrs;</span><br><span class="line">-- 查询月薪最高的员工姓名和月薪</span><br><span class="line">-- select ename, sal <span class="keyword">from</span> tb_emp order by sal desc limit <span class="number">1</span>;</span><br><span class="line">select ename, sal <span class="keyword">from</span> tb_emp where sal=(select <span class="built_in">max</span>(sal) <span class="keyword">from</span> tb_emp);</span><br><span class="line">select ename, sal <span class="keyword">from</span> tb_emp t1 where <span class="keyword">not</span> exists (select <span class="string">&#x27;x&#x27;</span> <span class="keyword">from</span> tb_emp t2 where t2.sal&gt;t1.sal);</span><br><span class="line">select ename, sal <span class="keyword">from</span> tb_emp t1 where (select count(*) <span class="keyword">from</span> tb_emp t2 where t2.sal&gt;t1.sal)=<span class="number">0</span>;</span><br><span class="line">select ename, sal <span class="keyword">from</span> tb_emp t1 where (select count(*) <span class="keyword">from</span> tb_emp t2 where t2.sal&gt;t1.sal)&lt;<span class="number">1</span>;</span><br><span class="line">-- 查询员工的姓名和年薪((月薪+补贴)*<span class="number">13</span>)</span><br><span class="line">select ename, (ifnull(sal, <span class="number">0</span>) + ifnull(comm, <span class="number">0</span>))*<span class="number">13</span> <span class="keyword">as</span> yearly_salary <span class="keyword">from</span> tb_emp order by yearly_salary desc;</span><br><span class="line">-- 查询有员工的部门的编号和人数</span><br><span class="line"></span><br><span class="line">select dno <span class="keyword">as</span> 编号, count(eno) <span class="keyword">as</span> 人数 <span class="keyword">from</span> tb_emp group by dno;</span><br><span class="line"></span><br><span class="line">-- 查询所有部门的名称和人数</span><br><span class="line">select dname <span class="keyword">as</span> 名称, ifnull(人数, <span class="number">0</span>) <span class="keyword">from</span> tb_dept t1 left join (select dno, count(eno) <span class="keyword">as</span> 人数 <span class="keyword">from</span> tb_emp group by dno) t2 on t1.dno=t2.dno;</span><br><span class="line">-- 查询月薪最高的员工(Boss除外)的姓名和月薪</span><br><span class="line">-- select ename, sal <span class="keyword">from</span> tb_emp where job&lt;&gt;<span class="string">&#x27;总裁&#x27;</span> order by sal desc limit <span class="number">1</span>;</span><br><span class="line">select ename, sal <span class="keyword">from</span> tb_emp where sal=(select <span class="built_in">max</span>(sal) <span class="keyword">from</span> tb_emp where job&lt;&gt;<span class="string">&#x27;总裁&#x27;</span>);</span><br><span class="line">-- 查询月薪超过平均月薪的员工的姓名和月薪</span><br><span class="line"></span><br><span class="line">select ename, sal <span class="keyword">from</span> tb_emp where sal&gt;(select avg(sal) <span class="keyword">from</span> tb_emp);</span><br><span class="line"></span><br><span class="line">-- 查询月薪超过其所在部门平均月薪的员工的姓名、部门编号和月薪</span><br><span class="line">select ename, t1.dno, sal <span class="keyword">from</span> tb_emp t1 inner join </span><br><span class="line">(select dno, avg(sal) <span class="keyword">as</span> avg_sal <span class="keyword">from</span> tb_emp group by dno) t2 on t1.dno=t2.dno <span class="keyword">and</span> sal&gt;avg_sal order by t1.dno;</span><br><span class="line"></span><br><span class="line">-- 查询部门中月薪最高的人姓名、月薪和所在部门名称</span><br><span class="line">select ename, sal, dname <span class="keyword">from</span> tb_emp, tb_dept,</span><br><span class="line">(select dno, <span class="built_in">max</span>(sal) <span class="keyword">as</span> 最高薪水 <span class="keyword">from</span> tb_emp group by dno) t3</span><br><span class="line">where tb_emp.dno=tb_dept.dno <span class="keyword">and</span> tb_emp.dno=t3.dno <span class="keyword">and</span> sal=最高薪水;</span><br><span class="line"></span><br><span class="line">select ename, sal, dname <span class="keyword">from</span> tb_emp inner join tb_dept inner join</span><br><span class="line">(select dno, <span class="built_in">max</span>(sal) <span class="keyword">as</span> 最高薪水 <span class="keyword">from</span> tb_emp group by dno) t3</span><br><span class="line">on tb_emp.dno=tb_dept.dno <span class="keyword">and</span> tb_emp.dno=t3.dno <span class="keyword">and</span> sal=最高薪水;</span><br><span class="line"></span><br><span class="line">-- 查询月薪最高的员工姓名和月薪</span><br><span class="line">select ename, sal <span class="keyword">from</span> tb_emp t1 where (select count(*) <span class="keyword">from</span> tb_emp t2 where t2.sal&gt;t1.sal)=<span class="number">0</span>;</span><br><span class="line">select ename, sal <span class="keyword">from</span> tb_emp t1 where (select count(*) <span class="keyword">from</span> tb_emp t2 where t2.sal&gt;t1.sal)&lt;<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">-- 查询每个部门月薪的前两名的员工姓名,月薪和部门编号</span><br><span class="line">select ename, sal, dno <span class="keyword">from</span> tb_emp t1 where (</span><br><span class="line">select count(*) <span class="keyword">from</span> tb_emp t2 where t1.dno=t2.dno <span class="keyword">and</span> t2.sal&gt;t1.sal)&lt;<span class="number">2</span> </span><br><span class="line">order by dno asc, sal desc;</span><br><span class="line"></span><br><span class="line">-- 使用窗口函数 查询每个部门月薪的前两名的员工姓名,月薪和部门编号</span><br><span class="line">select ename, sal, dno <span class="keyword">from</span> </span><br><span class="line">(select </span><br><span class="line">rank() over (partition by dno order by sal desc) <span class="keyword">as</span> rank_num,</span><br><span class="line">ename, sal, dno</span><br><span class="line"><span class="keyword">from</span> tb_emp) temp where rank_num&lt;=<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">-- 查询主管的姓名和职位</span><br><span class="line">select ename, job <span class="keyword">from</span> tb_emp where eno <span class="keyword">in</span></span><br><span class="line">(select distinct mgr <span class="keyword">from</span> tb_emp where mgr <span class="keyword">is</span> <span class="keyword">not</span> null);</span><br><span class="line"></span><br><span class="line">select ename, job <span class="keyword">from</span> tb_emp where eno=<span class="built_in">any</span></span><br><span class="line">(select distinct mgr <span class="keyword">from</span> tb_emp where mgr <span class="keyword">is</span> <span class="keyword">not</span> null);</span><br><span class="line"></span><br><span class="line">select ename, job <span class="keyword">from</span> tb_emp t1 where exists</span><br><span class="line">(select <span class="string">&#x27;x&#x27;</span> <span class="keyword">from</span> tb_emp t2 where t1.eno=t2.mgr);</span><br><span class="line">-- 查询月薪排名<span class="number">4</span>~<span class="number">6</span>名的员工排名、姓名和月薪</span><br><span class="line">select ename, sal <span class="keyword">from</span> tb_emp order by sal desc limit <span class="number">3</span> offset <span class="number">3</span>;</span><br><span class="line">use hrs;</span><br><span class="line">select ename, sal,ranking <span class="keyword">from</span>(select ename, sal,</span><br><span class="line">row_number() over (order by sal desc ) <span class="keyword">as</span> rownum,</span><br><span class="line">rank() over (order by sal desc) <span class="keyword">as</span> ranking,</span><br><span class="line">dense_rank() over (order by sal desc) <span class="keyword">as</span> den_ranking </span><br><span class="line"><span class="keyword">from</span> tb_emp) tb_temp where ranking between <span class="number">4</span> <span class="keyword">and</span> <span class="number">6</span>;</span><br></pre></td></tr></table></figure>

<h2 id="通过python连接数据库插入数据"><a href="#通过python连接数据库插入数据" class="headerlink" title="通过python连接数据库插入数据"></a>通过python连接数据库插入数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">no = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;请输入部门编号:&quot;</span>))</span><br><span class="line">name = <span class="built_in">input</span>(<span class="string">&quot;请输入部门名称:&quot;</span>)</span><br><span class="line">loc = <span class="built_in">input</span>(<span class="string">&quot;请输入部门所在地:&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一步：创建连接</span></span><br><span class="line"><span class="comment"># 在默认情况下创建连接,相当于开启了一个事物环境</span></span><br><span class="line"><span class="comment"># 事物：把若干个（增删改）操作视为一个不可分割的原子性操作，要么全都成功，要么全都失败。</span></span><br><span class="line">conn = pymysql.connect(</span><br><span class="line">    host=<span class="string">&quot;主机名&quot;</span>,</span><br><span class="line">    database=<span class="string">&quot;hrs&quot;</span>,</span><br><span class="line">    user=<span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">    password=<span class="string">&quot;密码&quot;</span>,</span><br><span class="line">    port=<span class="number">3306</span>,</span><br><span class="line">    charset=<span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(conn)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 第二步：获取游标对象</span></span><br><span class="line">    <span class="keyword">with</span> conn.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">        <span class="comment"># 第三步：通过游标对象向数据库发出SQL并获取执行结果</span></span><br><span class="line">        <span class="comment"># 不允许任何形式的格式化字符串进行数据操作</span></span><br><span class="line">        affected_rows = cursor.execute(</span><br><span class="line">            <span class="string">&#x27;insert into tb_dept values (%s, %s, %s)&#x27;</span>,</span><br><span class="line">            (no, name, loc)</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> affected_rows == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;添加部门成功!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 第四步：手动提交</span></span><br><span class="line">    conn.commit()</span><br><span class="line"><span class="keyword">except</span> pymysql.MySQLError:</span><br><span class="line">    <span class="comment"># 手动回滚</span></span><br><span class="line">    conn.rollback()</span><br><span class="line"><span class="comment"># 第五步：关闭连接</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://lxmy.top/2021/09/13/stage2/2-2%20(13)/" data-id="ckthx4uol000xxcuc4q7295av" data-title="" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">weiter &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/09/13/stage2/2-2%20(9)/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/09/13/stage2/2-2%20(8)/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/09/13/stage2/2-2%20(7)/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/09/13/stage2/2-2%20(6)/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/09/13/stage2/2-2%20(5)/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 徐明勇<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>